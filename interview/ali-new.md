[TOC]



# å½’çº³æ€»ç»“

1.é¡¹ç›®ä¸­å­¦åˆ°äº†ä»€ä¹ˆæŠ€æœ¯

2.å¾®æœåŠ¡çš„åˆ’åˆ†é¢—ç²’

3.å¾®æœåŠ¡çš„é«˜å¯ç”¨æ€ä¹ˆä¿è¯ï¼Ÿ

4.å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ï¼Œè¯¥æ€ä¹ˆç”¨ï¼Ÿä½ èƒ½è¯´ä¸‹å—ï¼Ÿ

5.ç½‘å…³èƒ½å¤Ÿä¸ºåç«¯æœåŠ¡å¸¦æ¥å“ªäº›å¥½å¤„

10.hashcodeå’Œequalsæ–¹æ³•å¸¸ç”¨çš„åœ°æ–¹

13.object toStringæ–¹æ³•å¸¸ç”¨çš„åœ°æ–¹ï¼Œä¸ºä»€ä¹ˆè¦é‡å†™è¯¥æ–¹æ³•

14.setå’Œlistçš„åŒºåˆ«

17.setæ‘çš„é¡ºåºæ˜¯æœ‰åºçš„å—ï¼Ÿ

18.å¸¸è§setçš„å®ç°ç”±å“ªäº›

19.TreeSetå¯¹å­˜å…¥å¯¹æ•°æ®æœ‰ä»€ä¹ˆè¦æ±‚

20.hashsetçš„åº•å±‚å®ç°å‘¢

21.treesetåº•å±‚æºç æœ‰çœ‹è¿‡å—ï¼Ÿ

22.hashsetæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„

23.javaä¸­æœ‰å“ªäº›çº¿ç¨‹å®‰å…¨çš„map

26.å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ

27.synchronizedï¼Œlock

28.volatileçš„åŸå­æ€§é—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆ i++ä¸æ”¯æŒåŸå­æ€§ï¼Œä»è®¡ç®—æœºåŸç†çš„è®¾è®¡æ¥è®²ä¸‹ä¸èƒ½ä¿è¯åŸå­æ€§çš„åŸå› 

30.casæ“ä½œ

31.lockå’Œsynchronizedçš„åŒºåˆ«

32.å…¬å¹³[é”å’Œ](https://www.baidu.com/s?wd=%E9%94%81%E5%92%8C&tn=24004469_oem_dg&rsv_dl=gh_pl_sl_csd)éå…¬å¹³é”

33.java[è¯»å†™é”](https://www.baidu.com/s?wd=%E8%AF%BB%E5%86%99%E9%94%81&tn=24004469_oem_dg&rsv_dl=gh_pl_sl_csd)

34.è¯»å†™é”è®¾è®¡ä¸»è¦è§£å†³ä»€ä¹ˆé—®é¢˜

35.ä½ é¡¹ç›®é™¤äº†å†™javaä»£ç ï¼Œè¿˜æœ‰å‰æ®µä»£ç ï¼Œé‚£ä½ çŸ¥é“å‰æ®µæœ‰å“ªäº›æ¡†æ¶å—ï¼Ÿ

36.mysqlåˆ†é¡µæŸ¥è¯¢è¯­å¥

40.å‰æ®µæ¸¸è§ˆå™¨çš„ä¸€ä¸ªhttpè¯·æ±‚é“åç«¯æ•´ä¸ªæµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿèƒ½å¤Ÿè¯´ä¸‹å—ï¼Ÿ

42.dnsä½ çŸ¥é“æ˜¯å¹²å˜›çš„å—ï¼Ÿ

44.ä»£ç ç‰ˆæœ¬ç®¡ç†ç”¨ä»€ä¹ˆ

45.git rebaseå’Œmergeæœ‰ä»€ä¹ˆåŒºåˆ«



1.é¡¹ç›®ä¸­çš„ç›‘æ§ï¼šé‚£ä¸ªç›‘æ§æŒ‡æ ‡å¸¸è§æœ‰å“ªäº›

2.ä¸ºæœåŠ¡è®¾è®¡åˆ°çš„æŠ€æœ¯ä»¥åŠéœ€è¦æ³¨æ„çš„é—®é¢˜æœ‰å“ªäº›

3.æ³¨å†Œä¸­å¿ƒä½ äº†è§£äº†è§£å“ªäº›

4.consulçš„å¯é æ€§ä½ äº†è§£å—

5.consulçš„æœºåˆ¶ä½ æœ‰å…·ä½“æ·±å…¥äº†è§£è¿‡å—ï¼Ÿæœ‰æ²¡æœ‰å’Œå…¶ä»–çš„æ³¨å†Œä¸­å¿ƒå¯¹æ¯”è¿‡

7.Spring booté™¤äº†è‡ªåŠ¨è£…é…ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„Springæœ‰å“ªäº›å…¶ä»–çš„åŒºåˆ«

8.Spring cloudæœ‰äº†è§£å¤šå°‘

13.çº¿ä¸ŠæœåŠ¡[CPU](https://www.baidu.com/s?wd=CPU&tn=24004469_oem_dg&rsv_dl=gh_pl_sl_csd)å¾ˆé«˜è¯¥æ€ä¹ˆåšï¼Ÿæœ‰å“ªäº›æªæ–½å¯ä»¥æ‰¾åˆ°é—®é¢˜ï¼Ÿ

19.è¯´ä¸‹ä½ çŸ¥é“çš„æ’åºç®—æ³•

## JavaåŸºç¡€

### åå°„

#### åå°„çš„åŸç†



#### åå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼æ˜¯ä»€ä¹ˆ



#### åå°„ä¸­ï¼ŒClass.forNameå’ŒClassLoaderåŒºåˆ« 



### è®¾è®¡æ¨¡å¼

#### å•ä¾‹

##### å†™å‡ºä¸‰ç§å•ä¾‹æ¨¡å¼å®ç° 

### è¯·åˆ—å‡º5ä¸ªè¿è¡Œæ—¶å¼‚å¸¸

### æ³›å‹çš„å­˜åœ¨æ˜¯ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜



##project

**é¡¹ç›®ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼**

æ¨¡æ¿æ–¹æ³•ã€

å•ä¾‹æ¨¡å¼ã€

å»ºé€ è€…æ¨¡å¼ï¼šProtobuf ,ç”Ÿæˆçš„åè®®å¯¹è±¡åœ¨æ„å»ºçš„æ—¶å€™

è´£ä»»é“¾æ¨¡å¼ï¼šNetty çš„ ChannelPipeline åŸºäºè´£ä»»é“¾æ¨¡å¼å¼€å‘

## framework

###Spring

**é¡¹ç›®ç”¨Springæ¯”è¾ƒå¤šï¼Œæœ‰æ²¡æœ‰äº†è§£è¿‡Springçš„åŸç†ï¼ŸAOPå’ŒIOCçš„åŸç†**

Â Â Â Â Â Â Â AOPï¼ˆè¿™é‡Œçš„AOPæŒ‡çš„æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹æ€æƒ³ï¼Œè€Œä¸æ˜¯Spring AOPï¼‰ä¸»è¦çš„çš„å®ç°æŠ€æœ¯ä¸»è¦æœ‰Spring AOPå’ŒAspectJã€‚

1ã€AspectJçš„åº•å±‚æŠ€æœ¯ã€‚

Â Â Â Â Â Â Â AspectJçš„åº•å±‚æŠ€æœ¯æ˜¯é™æ€ä»£ç†ï¼Œå³ç”¨ä¸€ç§AspectJæ”¯æŒçš„ç‰¹å®šè¯­è¨€ç¼–å†™åˆ‡é¢ï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥ç¼–è¯‘ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ä»£ç†ç±»ï¼Œè¯¥ä»£ç†ç±»å¢å¼ºäº†ä¸šåŠ¡ç±»ï¼Œè¿™æ˜¯åœ¨ç¼–è¯‘æ—¶å¢å¼ºï¼Œç›¸å¯¹äºä¸‹é¢è¯´çš„è¿è¡Œæ—¶å¢å¼ºï¼Œç¼–è¯‘æ—¶å¢å¼ºçš„æ€§èƒ½æ›´å¥½ã€‚

2ã€Spring AOP

Â Â Â Â Â  Â Spring AOPé‡‡ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†ï¼Œåœ¨è¿è¡ŒæœŸé—´å¯¹ä¸šåŠ¡æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œæ‰€ä»¥ä¸ä¼šç”Ÿæˆæ–°ç±»ï¼Œå¯¹äºåŠ¨æ€ä»£ç†æŠ€æœ¯ï¼ŒSpring AOPæä¾›äº†å¯¹JDKåŠ¨æ€ä»£ç†çš„æ”¯æŒä»¥åŠCGLibçš„æ”¯æŒã€‚

Â Â Â Â Â Â Â JDKåŠ¨æ€ä»£ç†åªèƒ½ä¸ºæ¥å£åˆ›å»ºåŠ¨æ€ä»£ç†å®ä¾‹ï¼Œè€Œä¸èƒ½å¯¹ç±»åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚éœ€è¦è·å¾—è¢«ç›®æ ‡ç±»çš„æ¥å£ä¿¡æ¯ï¼ˆåº”ç”¨Javaçš„åå°„æŠ€æœ¯ï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªå®ç°äº†ä»£ç†æ¥å£çš„åŠ¨æ€ä»£ç†ç±»ï¼ˆå­—èŠ‚ç ï¼‰ï¼Œå†é€šè¿‡åå°„æœºåˆ¶è·å¾—åŠ¨æ€ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆ©ç”¨æ„é€ å‡½æ•°ç”ŸæˆåŠ¨æ€ä»£ç†ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œåœ¨è°ƒç”¨å…·ä½“æ–¹æ³•å‰è°ƒç”¨invokeHandleræ–¹æ³•æ¥å¤„ç†ã€‚

Â Â Â Â Â Â Â CGLibåŠ¨æ€ä»£ç†éœ€è¦ä¾èµ–asmåŒ…ï¼ŒæŠŠè¢«ä»£ç†å¯¹è±¡ç±»çš„classæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆå­ç±»ã€‚

â€‹	ä½†æ˜¯Spring AOPåŸºäºæ³¨è§£é…ç½®çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ä¾èµ–äºAspectJåŒ…çš„æ ‡å‡†æ³¨è§£ï¼Œä½†æ˜¯ä¸éœ€è¦é¢å¤–çš„ç¼–è¯‘ä»¥åŠAspectJçš„ç»‡å…¥å™¨ï¼Œè€ŒåŸºäºXMLé…ç½®ä¸éœ€è¦ã€‚





####Spring beançš„ç”Ÿå‘½å‘¨æœŸ

ä¸»è¦çš„åˆ›å»ºæµç¨‹éƒ½åœ¨æ–¹æ³•`AbstractAutowireCapableBeanFactory#doCreateBean` ä¸­ï¼Œä¸‹é¢æ¥ä¸€æ­¥ä¸€æ­¥çš„çœ‹

##### 1.å®ä¾‹åŒ– Bean å¯¹è±¡(instantiateBean)

åœ¨`Spring` ä¸­ `instantiate` è¡¨ç¤ºå®ä¾‹åŒ–çš„æ„æ€

1. ```
   BeanWrapper instanceWrapper = createBeanInstance(beanName, mbd, args);
   ```

2. è¿›å…¥`createBeanInstance` æ–¹æ³•ä¸­ï¼Œæ­¤æ–¹æ³•ä¼šè°ƒç”¨`instantiateBean(beanName, mbd);` æ–¹æ³•

##### 2.å±æ€§æ³¨å…¥(populateBean)

è°ƒç”¨`populateBean(beanName, mbd, instanceWrapper);` æ–¹æ³•è¿›è¡Œå±æ€§è¾“å…¥

##### 3.åˆå§‹åŒ–æ•°æ®(initializeBean)

åˆå§‹åŒ–æ•°æ®ä¸»è¦ä½¿ç”¨äº†å¦‚ä¸‹çš„æ–¹æ³•ï¼š

```java
protected Object initializeBean(final String beanName, final Object bean, @Nullable RootBeanDefinition mbd) {
    invokeAwareMethods(beanName, bean);
    wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);
    invokeInitMethods(beanName, wrappedBean, mbd);
	wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);
	return wrappedBean;
}
```

å…·ä½“çš„è§£é‡Šçœ‹ä¸‹é¢ï¼š



###### invokeAwareMethods

Aware æ¥å£çš„æ³¨å…¥ï¼Œå¯¹åº”NameAwareï¼ŒBeanClassLoaderAwareï¼ŒBeanFactoryAware

###### applyBeanPostProcessorsBeforeInitialization

å¾ªç¯è°ƒç”¨`BeanPostProcessor `  çš„  `postProcessBeforeInitialization` æ–¹æ³•

###### invokeInitMethods

æ­¤æ–¹æ³•ç”¨æ¥æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼Œé‚£ä¹ˆåˆå§‹åŒ–æ–¹æ³•æœ‰å“ªäº›å‘¢ï¼Œå‚çœ‹ Spring ä¸‹é¢çš„é¢è¯•é¢˜ `æŒ‡å®šBeançš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•`

æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹ä»£ç å®ç°ï¼š

```java
protected void invokeInitMethods(String beanName, final Object bean, @Nullable RootBeanDefinition mbd)
		throws Throwable {
	//çœç•¥éƒ¨åˆ†ä»£ç 
    //å¦‚æœå®ç°äº†InitializingBean æ¥å£ï¼Œè°ƒç”¨å…¶afterPropertiesSet æ–¹æ³•
	boolean isInitializingBean = (bean instanceof InitializingBean);
	((InitializingBean) bean).afterPropertiesSet();


	if (mbd != null && bean.getClass() != NullBean.class) {
		String initMethodName = mbd.getInitMethodName();
		if (StringUtils.hasLength(initMethodName) &&
				!(isInitializingBean && "afterPropertiesSet".equals(initMethodName)) &&
				!mbd.isExternallyManagedInitMethod(initMethodName)) {
            //è°ƒç”¨è‡ªå®šä¹‰çš„ Init æ–¹æ³•ï¼Œå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨xmlé…ç½®ï¼Œæˆ–è€…@Beanæ³¨è§£è®¾ç½®çš„ init-method å±æ€§æŒ‡å®šçš„æ–¹æ³•
			invokeCustomInitMethod(beanName, bean, mbd);
		}
	}
}
```

JSR250 è§„èŒƒä¸­ä½¿ç”¨`@PostConstruct` åœ¨ä»£ç ä¸­å“ªé‡Œå®ç°çš„ç•™å¾…ä»¥åæŸ¥çœ‹//TODO

###### applyBeanPostProcessorsAfterInitialization

å¾ªç¯è°ƒç”¨`BeanPostProcessor `  çš„  `postProcessAfterInitialization` æ–¹æ³•

##### 4.Bean çš„é”€æ¯

å¦‚æœ Bean å®ç° **DisposableBean** æ¥å£ï¼Œå½“ spring å®¹å™¨å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨ `#destroy()` æ–¹æ³•ã€‚

å¦‚æœä¸º bean æŒ‡å®šäº† **destroy** æ–¹æ³•ï¼ˆä¾‹å¦‚ `<bean />` çš„ `destroy-method` å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå°†è°ƒç”¨è¯¥æ–¹æ³•ã€‚



#### è®²è®²SpringåŠ è½½æµç¨‹

å®ä¾‹åŒ– `BeanFactoryPostProcessor` å®ç°ç±» ,

ç„¶åè°ƒç”¨å…¶ `postProcessBeanFactory` æ–¹æ³•

å®ä¾‹åŒ–`BeanPostProcessor` å®ç°ç±»

å®ä¾‹åŒ–  InstantiationAwareBeanPostProcessor å®ç°ç±»ï¼Œå®ƒä¹Ÿæ˜¯ `extends BeanPostProcessor`

#### Spring AOPçš„å®ç°åŸç†

#### è®²è®²Springäº‹åŠ¡çš„ä¼ æ’­å±æ€§

#### Springå¦‚ä½•ç®¡ç†äº‹åŠ¡çš„

####Springæ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–



####XMLä¸­é…ç½®initï¼Œdestroyæ–¹æ³•æ€ä¹ˆå¯ä»¥åšåˆ°è°ƒç”¨å…·ä½“çš„æ–¹æ³•ï¼Ÿ



AbstractAutowireCapableBeanFactory çš„  initializeBean æ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨applyBeanPostProcessors çš„ before å’Œ after æ–¹æ³•ï¼Œç„¶åï¼Œè¿™ä¸¤å¤„è°ƒç”¨çš„ä¸­é—´ï¼Œæœ‰ä¸ª `invokeInitMethods` æ–¹æ³•ï¼Œè¿›å…¥æ–¹æ³•ï¼Œä¼šè°ƒç”¨ `InitializingBean` ç±»çš„ `afterPropertiesSet` æ–¹æ³•ä¹‹åï¼Œç„¶åä¼šå°è¯•è°ƒç”¨ `invokeCustomInitMethod` 



####æ³¨è§£æ³¨å†Œbeanåˆ°iocå®¹å™¨çš„å‡ ç§æ–¹å¼

1. åœ¨ä¸Šé¢çš„é…ç½®ç±»ä¸ŠåŠ `@Service`æˆ–è€…`@Component`ç­‰æ³¨è§£ï¼Œspringbootä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ä¸‹é¢æ‰€æœ‰å¸¦æœ‰è¿™äº›æ³¨è§£çš„ç±»ï¼Œå®ä¾‹åŒ–beanåŠ åˆ°iocå®¹å™¨ã€‚

2. ä½¿ç”¨`@Configuration`å’Œ`@Bean`æ³¨è§£æ¥é…ç½®beanåˆ°iocå®¹å™¨,è¿™ä¸ªç±»ä¹Ÿéœ€è¦åœ¨springbootå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…æˆ–è€…å­åŒ…ä¸‹é¢ï¼Œå¦åˆ™æ— æ³•æ‰«åˆ°ã€‚

3. ä½¿ç”¨`@Import`æ³¨è§£

   ç›¸ä¿¡å¾ˆå¤šäººå¯¹`@EnableScheduling` ã€`@EnableCaching`ç­‰@Enablexxxxç³»åˆ—çš„æ³¨è§£éƒ½ä¸é™Œç”Ÿï¼Œå®ƒä»¬å°±æ˜¯ä½¿ç”¨çš„æ˜¯@Importæ³¨è§£æ¥å®ç°å¼€å¯xxåŠŸèƒ½çš„ã€‚

#### æŒ‡å®šBeançš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•

**1. **é€šè¿‡@BeanæŒ‡å®šinit-methodå’Œdestroy-methodï¼›

**2. **é€šè¿‡è®©Beanå®ç°InitializingBeanï¼ˆå®šä¹‰åˆå§‹åŒ–é€»è¾‘ï¼‰ï¼ŒDisposableBeanï¼ˆå®šä¹‰é”€æ¯é€»è¾‘ï¼‰;

**3.** å¯ä»¥ä½¿ç”¨JSR250ï¼›

@PostConstructï¼šåœ¨beanåˆ›å»ºå®Œæˆå¹¶ä¸”å±æ€§èµ‹å€¼å®Œæˆï¼›æ¥æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•

@PreDestroyï¼šåœ¨å®¹å™¨é”€æ¯beanä¹‹å‰é€šçŸ¥æˆ‘ä»¬è¿›è¡Œæ¸…ç†å·¥ä½œ


### SpringMVC

#### Springmvc ä¸­DispatcherServletåˆå§‹åŒ–è¿‡ç¨‹



#### Controlleræ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹ï¼Œæ€ä¹ˆä¿è¯å¹¶å‘çš„å®‰å…¨

Controlleré»˜è®¤æ˜¯å•ä¾‹,



### SpringBoot

####SpringBoot starter åŸç†ï¼ˆè‡ªåŠ¨é…ç½®åŸç†ï¼‰

é¦–å…ˆè¯´è¯´åŸç†ï¼Œæˆ‘ä»¬çŸ¥é“ä½¿ç”¨ä¸€ä¸ªå…¬ç”¨çš„starterçš„æ—¶å€™ï¼Œåªéœ€è¦å°†ç›¸åº”çš„ä¾èµ–æ·»åŠ çš„Mavençš„é…ç½®æ–‡ä»¶å½“ä¸­å³å¯ï¼Œå…å»äº†è‡ªå·±éœ€è¦å¼•ç”¨å¾ˆå¤šä¾èµ–ç±»ï¼Œå¹¶ä¸”SpringBootä¼šè‡ªåŠ¨è¿›è¡Œç±»çš„è‡ªåŠ¨é…ç½®ã€‚é‚£ä¹ˆ SpringBoot æ˜¯å¦‚ä½•çŸ¥é“è¦å®ä¾‹åŒ–å“ªäº›ç±»ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨é…ç½®çš„å‘¢ï¼Ÿ ä¸‹é¢ç®€å•è¯´ä¸€ä¸‹ã€‚

1. é¦–å…ˆï¼ŒSpringBoot åœ¨å¯åŠ¨æ—¶ä¼šå»ä¾èµ–çš„starteråŒ…ä¸­å¯»æ‰¾ `resources/META-INF/spring.factories `æ–‡ä»¶ï¼Œç„¶åæ ¹æ®æ–‡ä»¶ä¸­é…ç½®çš„JaråŒ…å»æ‰«æé¡¹ç›®æ‰€ä¾èµ–çš„JaråŒ…ï¼Œè¿™ç±»ä¼¼äº Java çš„ **SPI** æœºåˆ¶ã€‚
2. ç¬¬äºŒæ­¥ï¼Œæ ¹æ® `spring.factories`é…ç½®åŠ è½½`AutoConfigure`ç±»ã€‚
3. æœ€åï¼Œæ ¹æ® `@Conditional`æ³¨è§£çš„æ¡ä»¶ï¼Œè¿›è¡Œè‡ªåŠ¨é…ç½®å¹¶å°†Beanæ³¨å…¥Spring Context ä¸Šä¸‹æ–‡å½“ä¸­ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`@ImportAutoConfiguration({MyServiceAutoConfiguration.class})` æŒ‡å®šè‡ªåŠ¨é…ç½®å“ªäº›ç±»ã€‚

ä¸‹é¢å…·ä½“ä»£ç ï¼š

```java
@EnableAutoConfiguration
public @interface SpringBootApplication {
}

@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {
}
```

å› ä¸ºä½¿ç”¨`@Import` æ³¨è§£å¼•å…¥`AutoConfigurationImportSelector` ç±»ï¼Œè¿›å…¥è¿™ä¸ªç±»çš„`selectImports`

```java
@Override
public String[] selectImports(AnnotationMetadata annotationMetadata) {
    if (!isEnabled(annotationMetadata)) {
        return NO_IMPORTS;
    }
    AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader
        .loadMetadata(this.beanClassLoader);
    //çœ‹è¿™é‡Œ
    AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(
        autoConfigurationMetadata, annotationMetadata);
    return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());
}
```

è¿›å…¥`AutoConfigurationImportSelector.getAutoConfigurationEntry`æ–¹æ³•ï¼š

```java
protected AutoConfigurationEntry getAutoConfigurationEntry(
    AutoConfigurationMetadata autoConfigurationMetadata,
    AnnotationMetadata annotationMetadata) {
    AnnotationAttributes attributes = getAttributes(annotationMetadata);
    //çœç•¥äº†å…¶ä»–çš„ä»£ç ï¼Œä¸»è¦æ˜¯è¿™é‡Œ
    List<String> configurations = getCandidateConfigurations(annotationMetadata,
                                                             attributes);
}
```

è¿›å…¥`AutoConfigurationImportSelector#getCandidateConfigurations`æ–¹æ³•ï¼Œ**è¯¥æ–¹æ³•ä¼šå»è·å–æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»çš„åç§°**ã€‚

1. è¯¥æ–¹æ³•ä¼šæ‰«æjaråŒ…è·¯å¾„ä¸‹çš„`META-INF/spring.factories` æ–‡ä»¶ï¼ŒæŠŠæ‰«æåˆ°çš„è¿™äº›æ–‡ä»¶å†…å®¹åŒ…è£…æˆpropertieså¯¹è±¡ã€‚
2. å†ä»propertiesä¸­è·å–åˆ°EnableAutoConfiguration.classç±»ï¼ˆç±»åï¼‰ä¸ºkey å¯¹åº”çš„å€¼ï¼Œå¹¶ä¸”æŠŠä»–ä»¬æ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚
3. æ‰“å¼€ä¸€ä¸ª`spring.factories`æ–‡ä»¶ï¼Œçœ‹åˆ°çš„éå¸¸å¤šçš„xxxxAutoConfigurationç±»ï¼Œè¿™äº›ç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼ŒåŠ å…¥åˆ°å®¹å™¨ä¸­ï¼Œç”¨ä»–ä»¬åšè‡ªåŠ¨é…ç½®ã€‚

æˆ‘ä»¬çœ‹ä¸€ä¸ªè‡ªåŠ¨è£…é…çš„ä¾‹å­`RedisAutoConfiguration`,è¿™æ˜¯è‡ªå®šä¹‰çš„ä¸€ä¸ªè‡ªåŠ¨è£…é…çš„ç±»ï¼Œå…¶ä¸­å°±æ˜¯å€ŸåŠ©`Conditional`ç›¸å…³çš„æ³¨è§£æ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œå‘å®¹å™¨ä¸­æ³¨å…¥bean

```java
@Configuration
@ConditionalOnProperty(value = "spring.redis.enabled",matchIfMissing = true)
@ConditionalOnClass({ RedisTemplate.class })
@EnableCaching
@Slf4j
public class RedisAutoConfiguration extends CachingConfigurerSupport {

	@Bean
	@ConditionalOnMissingBean(RedisTemplate.class)
	public RedisTemplate<String, Object> redisTemplate(@Autowired RedisConnectionFactory redisConnectionFactory,
			@Autowired RedisSerializer<Object> redisSerializer)
			throws UnknownHostException {
		RedisTemplate<String, Object> template = new RedisTemplate<String, Object>();
		template.setConnectionFactory(redisConnectionFactory);
		template.setHashValueSerializer(redisSerializer);
		template.setValueSerializer(redisSerializer);
		StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(Charset.forName("UTF-8"));
		template.setHashKeySerializer(stringRedisSerializer);
		template.setKeySerializer(stringRedisSerializer);
		log.info("redisTemplate init success");
		return template;
	}

	 @Bean
	 @ConditionalOnMissingBean(value = RedisSerializer.class)
     public RedisSerializer<Object> redisSerializer() {
         return new GenericFastJsonRedisSerializer();
     }
}
```





####starter å‘½åæ ¼å¼

æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„Springå®˜æ–¹çš„Starterä¸€èˆ¬é‡‡å–`spring-boot-starter-{name} `çš„å‘½åæ–¹å¼ï¼Œå¦‚ `spring-boot-starter-web `ã€‚

è€Œéå®˜æ–¹çš„Starterï¼Œå®˜æ–¹å»ºè®® `artifactId` å‘½ååº”éµå¾ª`{name}-spring-boot-starter `çš„æ ¼å¼ã€‚ ä¾‹å¦‚ï¼š`ysc-spring-boot-starter ` ã€‚



#### è‡ªåŠ¨é…ç½® V.S è‡ªåŠ¨è£…é…

- è‡ªåŠ¨é…ç½®ï¼šæ˜¯ Spring Boot æä¾›çš„ï¼Œå®ç°é€šè¿‡ jar åŒ…çš„ä¾èµ–ï¼Œèƒ½å¤Ÿè‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚è¯´ï¼šæˆ‘ä»¬å¼•å…¥ `spring-boot-starter-web` ä¹‹åï¼Œå°±è‡ªåŠ¨å¼•å…¥äº† Spring MVC ç›¸å…³çš„ jar åŒ…ï¼Œä»è€Œè‡ªåŠ¨é…ç½® Spring MVC ã€‚
- è‡ªåŠ¨è£…é…ï¼šæ˜¯ Spring æä¾›çš„ IoC æ³¨å…¥æ–¹å¼ï¼Œæ¯”å¦‚ä½¿ç”¨ä½¿ç”¨`byName`æˆ–è€…`byType`è‡ªåŠ¨è£…é…beanå¯¹è±¡



### Dubbo

#### Dubbo æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ



**Random LoadBalance**

- **éšæœº**ï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ã€‚
- åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’çš„æ¦‚ç‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚ç‡ä½¿ç”¨æƒé‡åä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚



**RoundRobin LoadBalance**

- **è½®è¯¢**ï¼ŒæŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®è¯¢æ¯”ç‡ã€‚

- å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚

  > ä¸¾ä¸ªæ —å­ã€‚
  >
  > è·Ÿè¿ç»´åŒå­¦ç”³è¯·æœºå™¨ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿æ°”å¥½ï¼Œæ­£å¥½å…¬å¸èµ„æºæ¯”è¾ƒå……è¶³ï¼Œåˆšåˆšæœ‰ä¸€æ‰¹çƒ­æ°”è…¾è…¾ã€åˆšåˆšåšå¥½çš„ä¸€æ‰¹è™šæ‹Ÿæœºæ–°é²œå‡ºç‚‰ï¼Œé…ç½®éƒ½æ¯”è¾ƒé«˜ã€‚8æ ¸+16gï¼Œæœºå™¨ï¼Œ2 å°ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘æ„Ÿè§‰ 2 å°æœºå™¨æœ‰ç‚¹ä¸å¤ªå¤Ÿï¼Œæˆ‘å»æ‰¾è¿ç»´åŒå­¦ï¼Œå“¥å„¿ä»¬ï¼Œä½ èƒ½ä¸èƒ½å†ç»™æˆ‘ 1 å°æœºå™¨ï¼Œ4æ ¸+8Gçš„æœºå™¨ã€‚æˆ‘è¿˜æ˜¯å¾—è¦ã€‚
  >
  > è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥ç»™ä¸¤å° 8æ ¸16g çš„æœºå™¨è®¾ç½®æƒé‡ 4ï¼Œç»™å‰©ä½™ 1 å° 4æ ¸8G çš„æœºå™¨è®¾ç½®æƒé‡ 2ã€‚



**LeastActive LoadBalance**

- **æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°**ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ã€‚

- ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚

  > è¿™ä¸ªå°±æ˜¯è‡ªåŠ¨æ„ŸçŸ¥ä¸€ä¸‹ï¼Œå¦‚æœæŸä¸ªæœºå™¨æ€§èƒ½è¶Šå·®ï¼Œé‚£ä¹ˆæ¥æ”¶çš„è¯·æ±‚è¶Šå°‘ï¼Œè¶Šä¸æ´»è·ƒï¼Œæ­¤æ—¶å°±ä¼šç»™ä¸æ´»è·ƒçš„æ€§èƒ½å·®çš„æœºå™¨æ›´å°‘çš„è¯·æ±‚ã€‚



**ConsistentHash LoadBalance**

- **ä¸€è‡´æ€§ Hash**ï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚
- å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚



#### Dubbo SPI

##### æºç åˆ†æ

1. 

#### Dubboç›‘æ§å¹³å°èƒ½å¤ŸåŠ¨æ€æ”¹å˜æ¥å£çš„ä¸€äº›è®¾ç½®,å…¶åŸç†æ˜¯æ€æ ·çš„?

#### æœ€å°æ´»è·ƒæ•°ç®—æ³•ä¸­æ˜¯å¦‚ä½•ç»Ÿè®¡è¿™ä¸ªæ´»è·ƒæ•°çš„ï¼Ÿ

é’ˆå¯¹æ¯ä¸ªæœåŠ¡æ¥å£çš„æ¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®šä¹‰äº†ä¸€ä¸ª`RpcStatus` å¯¹è±¡æ¥ä¿å­˜çŠ¶æ€ï¼Œå…¶ä¸­æœ‰ä¸ªå­—æ®µå«`active` atomicInteger ç±»å‹çš„å­—æ®µç”¨æ¥è¡¨ç¤ºæ´»è·ƒæ•°ï¼Œåœ¨`ActiveLimitFilter`ä¸­æ¯å½“è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨å¼€å§‹ï¼Œactive åŠ 1ï¼Œè°ƒç”¨è¿”å›ï¼Œactive å‡1ï¼Œæ‰€ä»¥æ­¤å€¼è¶Šå°ï¼Œä»£è¡¨å½“å‰æ­£åœ¨å¤„ç†å¾—è°ƒç”¨å°±è¶Šå°‘ï¼Œæ‰€ä»¥è¯·æ±‚å°±å‘ç»™æ­¤Invoker

### Mybatis

### Netty

#### ç®€å•ä»‹ç» Netty çš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ

Netty æœ‰å¦‚ä¸‹å…­ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

- Bootstrap & ServerBootstrap
- Channel
- ChannelFuture
- EventLoop & EventLoopGroup
- ChannelHandler
- ChannelPipeline



#### ä»€ä¹ˆæ˜¯ Reactor æ¨¡å‹ï¼Ÿ

Reactor æœ‰ 3 ç§æ¨¡å‹å®ç°ï¼š

1. å• Reactor å•çº¿ç¨‹æ¨¡å‹
2. å• Reactor å¤šçº¿ç¨‹æ¨¡å‹
3. å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹



#### pollã€epollã€select çš„åŒºåˆ«

#### ä»€ä¹ˆæ˜¯é›¶æ‹·è´

ç»´åŸºä¸Šæ˜¯è¿™ä¹ˆæè¿°é›¶æ‹·è´çš„ï¼šé›¶æ‹·è´æè¿°çš„æ˜¯CPUä¸æ‰§è¡Œæ‹·è´æ•°æ®ä»ä¸€ä¸ªå­˜å‚¨åŒºåŸŸåˆ°å¦ä¸€ä¸ªå­˜å‚¨åŒºåŸŸçš„ä»»åŠ¡ï¼Œè¿™é€šå¸¸ç”¨äºé€šè¿‡ç½‘ç»œä¼ è¾“ä¸€ä¸ªæ–‡ä»¶æ—¶ä»¥å‡å°‘CPUå‘¨æœŸå’Œå†…å­˜å¸¦å®½ã€‚


##### é›¶æ‹·è´ç»™æˆ‘ä»¬å¸¦æ¥çš„å¥½å¤„ï¼š

- å‡å°‘ç”šè‡³å®Œå…¨é¿å…ä¸å¿…è¦çš„CPUæ‹·è´ï¼Œä»è€Œè®©CPUè§£è„±å‡ºæ¥å»æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡
- å‡å°‘å†…å­˜å¸¦å®½çš„å ç”¨
- é€šå¸¸é›¶æ‹·è´æŠ€æœ¯è¿˜èƒ½å¤Ÿå‡å°‘ç”¨æˆ·ç©ºé—´å’Œæ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢

https://www.jianshu.com/p/e76e3580e356

## network

### TCPæ»‘åŠ¨çª—å£åè®®

1. TCPçš„æ»‘åŠ¨çª—å£ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯æä¾›TCPçš„å¯é æ€§ï¼ŒäºŒæ˜¯æä¾›TCPçš„æµæ§ç‰¹æ€§ï¼Œæ»‘åŠ¨çª—å£åè®®æ˜¯**ä¼ è¾“å±‚è¿›è¡Œæµæ§**çš„ä¸€ç§æªæ–½ï¼Œ**æ¥æ”¶æ–¹é€šè¿‡é€šå‘Šå‘é€æ–¹è‡ªå·±çš„çª—å£å¤§å°**ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿåº¦ï¼Œ

2. TCPæ˜¯åŒå·¥çš„åè®®ï¼Œä¼šè¯çš„åŒæ–¹éƒ½å¯ä»¥åŒæ—¶æ¥æ”¶ã€å‘é€æ•°æ®ã€‚TCPä¼šè¯çš„åŒæ–¹éƒ½å„è‡ªç»´æŠ¤ä¸€ä¸ªâ€œå‘é€çª—å£â€å’Œä¸€ä¸ªâ€œæ¥æ”¶çª—å£â€ã€‚å…¶ä¸­å„è‡ªçš„â€œæ¥æ”¶çª—å£â€å¤§å°å–å†³äºåº”ç”¨ã€ç³»ç»Ÿã€ç¡¬ä»¶çš„é™åˆ¶ï¼ˆTCPä¼ è¾“é€Ÿç‡ä¸èƒ½å¤§äºåº”ç”¨çš„æ•°æ®å¤„ç†é€Ÿç‡ï¼‰ã€‚å„è‡ªçš„â€œå‘é€çª—å£â€åˆ™è¦æ±‚å–å†³äºå¯¹ç«¯é€šå‘Šçš„â€œæ¥æ”¶çª—å£â€ï¼Œè¦æ±‚ç›¸åŒã€‚

3. å¯¹äºTCPä¼šè¯çš„å‘é€æ–¹ï¼Œä»»ä½•æ—¶å€™åœ¨å…¶å‘é€ç¼“å­˜å†…çš„æ•°æ®éƒ½å¯ä»¥åˆ†ä¸º4ç±»ï¼Œâ€œå·²ç»å‘é€å¹¶å¾—åˆ°å¯¹ç«¯ACKçš„â€ï¼Œâ€œå·²ç»å‘é€ä½†è¿˜æœªæ”¶åˆ°å¯¹ç«¯ACKçš„â€ï¼Œâ€œæœªå‘é€ä½†å¯¹ç«¯å…è®¸å‘é€çš„â€ï¼Œâ€œæœªå‘é€ä¸”å¯¹ç«¯ä¸å…è®¸å‘é€â€ã€‚â€œå·²ç»å‘é€ä½†è¿˜æœªæ”¶åˆ°å¯¹ç«¯ACKçš„â€å’Œâ€œæœªå‘é€ä½†å¯¹ç«¯å…è®¸å‘é€çš„â€è¿™ä¸¤éƒ¨åˆ†æ•°æ®ç§°ä¹‹ä¸ºå‘é€çª—å£ã€‚

4. å¯¹äºTCPçš„æ¥æ”¶æ–¹ï¼Œåœ¨æŸä¸€æ—¶åˆ»åœ¨å®ƒçš„æ¥æ”¶ç¼“å­˜å†…å­˜åœ¨3ç§ã€‚â€œå·²æ¥æ”¶â€ï¼Œâ€œæœªæ¥æ”¶å‡†å¤‡æ¥æ”¶â€ï¼Œâ€œæœªæ¥æ”¶å¹¶æœªå‡†å¤‡æ¥æ”¶â€ï¼ˆç”±äºACKç›´æ¥ç”±TCPåè®®æ ˆå›å¤ï¼Œé»˜è®¤æ— åº”ç”¨å»¶è¿Ÿï¼Œä¸å­˜åœ¨â€œå·²æ¥æ”¶æœªå›å¤ACKâ€ï¼‰ã€‚å…¶ä¸­â€œæœªæ¥æ”¶å‡†å¤‡æ¥æ”¶â€ç§°ä¹‹ä¸ºæ¥æ”¶çª—å£ã€‚

5. å¯¹ACKçš„å†è®¤è¯†ï¼Œacké€šå¸¸è¢«ç†è§£ä¸ºæ”¶åˆ°æ•°æ®åç»™å‡ºçš„ä¸€ä¸ªç¡®è®¤ACKï¼ŒACKåŒ…å«ä¸¤ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼š
   **ä¸€æ˜¯æœŸæœ›æ¥æ”¶åˆ°çš„ä¸‹ä¸€å­—èŠ‚çš„åºå·nï¼Œè¯¥nä»£è¡¨æ¥æ”¶æ–¹å·²ç»æ¥æ”¶åˆ°äº†å‰n-1å­—èŠ‚æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœæ¥æ”¶æ–¹æ”¶åˆ°ç¬¬n+1å­—èŠ‚æ•°æ®è€Œä¸æ˜¯ç¬¬nå­—èŠ‚æ•°æ®ï¼Œ****æ¥æ”¶æ–¹æ˜¯ä¸ä¼šå‘é€åºå·ä¸ºn+2çš„ACKçš„ã€‚**ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æ¥æ”¶ç«¯æ”¶åˆ°1-1024å­—èŠ‚ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªç¡®è®¤å·ä¸º1025çš„ACK,ä½†æ˜¯æ¥ä¸‹æ¥æ”¶åˆ°çš„æ˜¯2049-3072ï¼Œå®ƒæ˜¯ä¸ä¼šå‘é€ç¡®è®¤å·ä¸º3072çš„ACK,è€Œä¾æ—§å‘é€1025çš„ACKã€‚

   **äºŒæ˜¯å½“å‰çš„çª—å£å¤§å°mï¼Œå¦‚æ­¤å‘é€æ–¹åœ¨æ¥æ”¶åˆ°ACKåŒ…å«çš„è¿™ä¸¤ä¸ªæ•°æ®åå°±å¯ä»¥è®¡ç®—å‡ºè¿˜å¯ä»¥å‘é€å¤šå°‘å­—èŠ‚çš„æ•°æ®ç»™å¯¹æ–¹ï¼Œå‡å®šå½“å‰å‘é€æ–¹å·²å‘é€åˆ°ç¬¬xå­—èŠ‚ï¼Œåˆ™å¯ä»¥å‘é€çš„å­—èŠ‚æ•°å°±æ˜¯y=m-(x-n).è¿™å°±æ˜¯æ»‘åŠ¨çª—å£æ§åˆ¶æµé‡çš„åŸºæœ¬åŸç†**


**TCPå’ŒUDPçš„åŒºåˆ«ï¼ŒTCPæ•°æ®ä¼ è¾“è¿‡ç¨‹å¦‚ä½•åšåˆ°å¯é çš„**



**httpé»˜è®¤ç«¯å£ï¼Œhttpsé»˜è®¤ç«¯å£**

http ï¼š 80

httpsï¼š443





## æ€§èƒ½ä¼˜åŒ–



## Jdk æºç 

###List

####ArralListå’ŒLinkedListåŒºåˆ«

ArrayList æ˜¯å®ç°äº†åŸºäºåŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºåœ°å€è¿ç»­ï¼Œä¸€æ—¦æ•°æ®å­˜å‚¨å¥½äº†ï¼ŒæŸ¥è¯¢æ“ä½œæ•ˆç‡ä¼šæ¯”è¾ƒé«˜ï¼ˆåœ¨å†…å­˜é‡Œæ˜¯è¿ç€æ”¾çš„ï¼‰ã€‚

å› ä¸ºåœ°å€è¿ç»­ï¼ŒArrayList è¦ç§»åŠ¨æ•°æ®ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡æ¯”è¾ƒä½ã€‚

LinkedList åŸºäºé“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œåœ°å€æ˜¯ä»»æ„çš„ï¼Œæ‰€ä»¥åœ¨å¼€è¾Ÿå†…å­˜ç©ºé—´çš„æ—¶å€™ä¸éœ€è¦ç­‰ä¸€ä¸ªè¿ç»­çš„åœ°å€ã€‚å¯¹äºæ–°å¢å’Œåˆ é™¤æ“ä½œ add å’Œ remove ï¼ŒLinedList æ¯”è¾ƒå ä¼˜åŠ¿ã€‚LinkedList é€‚ç”¨äºè¦å¤´å°¾æ“ä½œæˆ–æ’å…¥æŒ‡å®šä½ç½®çš„åœºæ™¯ã€‚

å› ä¸º LinkedList è¦ç§»åŠ¨æŒ‡é’ˆï¼Œæ‰€ä»¥æŸ¥è¯¢æ“ä½œæ€§èƒ½æ¯”è¾ƒä½ã€‚



####å¦‚æœå­˜ç›¸åŒæ•°æ®ï¼ŒArrayListå’ŒLinkedListè°å ç”¨ç©ºé—´æ›´å¤§

LinkedList æ˜æ˜¾æ›´å¤§ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹æœ‰å¾ˆå¤šçš„é¢å¤–æ•°æ®ï¼Œæ¯”å¦‚å‘å‰å’Œå‘åçš„ç´¢å¼•

###Map

#### HashMap

##### putç¡®å®šå…ƒç´ æ’å…¥ä½ç½®

é‡‡ç”¨å¦‚ä¸‹çš„äºŒè¿›åˆ¶è®¡ç®—æ–¹å¼

`(n - 1) & hash` ,n å°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œ

å¦‚æœæ•°ç»„é•¿åº¦æ˜¯16ï¼Œæ¢ç®—æˆäºŒè¿›åˆ¶ï¼Œå°±æ˜¯00000001111

å‰é¢å…¨æ˜¯0ï¼Œæ‰€ä»¥ä½¿ç”¨ & èƒ½å¾—åˆ°æ¡¶ä½

##### resizeï¼ˆæ‰©å®¹ï¼‰

jkd 8 `HashMap` æ‰©å®¹ï¼Œå…³é”®ç‚¹æ˜¯å¦‚ä¸‹çš„ä»£ç ï¼š

```java
do {
	next = e.next;
	if ((e.hash & oldCap) == 0) { //å…³é”®ç‚¹1ï¼Œç¡®å®šæ˜¯å¦è¿˜åœ¨åŸæ¥çš„ä½ç½®ä¸Š
		if (loTail == null)
			loHead = e;
		else
			loTail.next = e;
		loTail = e;
	}
	else {
		if (hiTail == null)
			hiHead = e;
		else
			hiTail.next = e;
		hiTail = e;
	}
} while ((e = next) != null);
if (loTail != null) {
	loTail.next = null;
	newTab[j] = loHead;
}
if (hiTail != null) {
	hiTail.next = null;
	newTab[j + oldCap] = hiHead;//å…³é”®ç‚¹2ï¼šå¦‚æœæ˜¯é«˜ä½ï¼Œå°±è¦åŠ ä¸Šä»¥å‰çš„å®¹é‡
}
```

æˆ‘ä»¬æ¥çœ‹çœ‹å…³é”®ç‚¹1çš„åŸç†ï¼š

è¦æƒ³æ˜ç™½å…³é”®ç‚¹1 çš„åŸç†ï¼Œæˆ‘ä»¬éœ€è¦ç»“åˆä¸Šé¢çš„é—®é¢˜`putç¡®å®šå…ƒç´ æ’å…¥ä½ç½®`

å› ä¸ºæˆ‘ä»¬æ‰©å®¹äº†ï¼Œé‚£ä¹ˆä»16æ‰©å±•åˆ°32ï¼Œæˆ‘ä»¬æ±‚æ•°æ®çš„ä½ç½®ï¼Œå°±æ˜¯ 1 1111 & hash

- ä½†æ˜¯å› ä¸ºï¼Œhashæ˜¯å›ºå®šä¸å˜çš„ï¼Œé‚£ä¹ˆ hash & 1111ï¼ˆå››ä½ï¼‰æ˜¯ä¸å˜çš„ï¼Œ
- é‚£ä¹ˆ`(e.hash & oldCap) == 0`å°±æ˜¯è¡¨ç¤ºï¼Œhash & 1 0000 ï¼ˆå°±æ˜¯ 32-1 ç›¸å¯¹äº 16-1 å¤šå‡ºæ¥çš„ç¬¬äº”ä½ï¼‰ä¸º0ï¼Œé‚£ä¹ˆå°±æ˜¯ hash & 1 1111 = hash & 1111 ï¼Œ**æ‰€ä»¥å°±è¿˜æ˜¯åŸæ¥çš„ä½ç½®**



#### LinkedHashMap 

##### ä½¿ç”¨`LinkedHashMap ` å®ç°ä¸€ä¸ªLRU cache

```java
class LRUCache<K, V> extends LinkedHashMap<K, V> {
    private final int CACHE_SIZE;

    /**
     * ä¼ é€’è¿›æ¥æœ€å¤šèƒ½ç¼“å­˜å¤šå°‘æ•°æ®
     *
     * @param cacheSize ç¼“å­˜å¤§å°
     */
    public LRUCache(int cacheSize) {
        // true è¡¨ç¤ºè®© LinkedHashMap æŒ‰ç…§è®¿é—®é¡ºåºæ¥è¿›è¡Œæ’åºï¼Œæœ€è¿‘è®¿é—®çš„æ”¾åœ¨å¤´éƒ¨ï¼Œæœ€è€è®¿é—®çš„æ”¾åœ¨å°¾éƒ¨ã€‚
        super((int) Math.ceil(cacheSize / 0.75) + 1, 0.75f, true);
        CACHE_SIZE = cacheSize;
    }

    @Override
    protected boolean removeEldestEntry(Map.Entry<K, V> eldest) {
        // å½“ map ä¸­çš„æ•°æ®é‡å¤§äºæŒ‡å®šçš„ç¼“å­˜ä¸ªæ•°çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨åˆ é™¤æœ€è€çš„æ•°æ®ã€‚
        return size() > CACHE_SIZE;
    }
    
}
```



####HashMapå’ŒHashtableåŒºåˆ«

- 1ã€Hashtable ç»§æ‰¿ Dictionary ï¼ŒHashMap ç»§æ‰¿çš„æ˜¯ Java2 å‡ºç°çš„ Map æ¥å£ã€‚
- 2ã€HashMap å»æ‰äº† Hashtable çš„ contains æ–¹æ³•ï¼Œä½†æ˜¯åŠ ä¸Šäº† containsValue å’Œ containsKey æ–¹æ³•ã€‚
- 3ã€HashMap å…è®¸ç©ºé”®å€¼ï¼Œè€Œ Hashtable ä¸å…è®¸ã€‚
- 4ã€ã€é‡ç‚¹ã€‘4ã€HashTable æ˜¯åŒæ­¥çš„ï¼Œè€Œ HashMap æ˜¯éåŒæ­¥çš„ï¼Œæ•ˆç‡ä¸Šæ¯” HashTable è¦é«˜ã€‚ä¹Ÿå› æ­¤ï¼ŒHashMap æ›´é€‚åˆäºå•çº¿ç¨‹ç¯å¢ƒï¼Œè€Œ HashTable é€‚åˆäºå¤šçº¿ç¨‹ç¯å¢ƒã€‚
- 5ã€HashMap çš„è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ˜¯ fail-fast è¿­ä»£å™¨ï¼ŒHashTableçš„ enumerator è¿­ä»£å™¨ä¸æ˜¯ fail-fast çš„ã€‚
- 6ã€HashTable ä¸­æ•°ç»„é»˜è®¤å¤§å°æ˜¯ 11 ï¼Œæ‰©å®¹æ–¹æ³•æ˜¯ `old * 2 + 1` ï¼ŒHashMap é»˜è®¤å¤§å°æ˜¯ 16 ï¼Œæ‰©å®¹æ¯æ¬¡ä¸º 2 çš„æŒ‡æ•°å¤§å°ã€‚

ä¸€èˆ¬ç°åœ¨ä¸å»ºè®®ç”¨ HashTable ã€‚ä¸»è¦åŸå› æ˜¯ä¸¤ç‚¹ï¼š

- ä¸€æ˜¯ï¼ŒHashTable æ˜¯é—ç•™ç±»ï¼Œå†…éƒ¨å®ç°å¾ˆå¤šæ²¡ä¼˜åŒ–å’Œå†—ä½™ã€‚
- äºŒæ˜¯ï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç°åœ¨ä¹Ÿæœ‰åŒæ­¥çš„ ConcurrentHashMap æ›¿ä»£ï¼Œæ²¡æœ‰å¿…è¦å› ä¸ºæ˜¯å¤šçº¿ç¨‹è€Œç”¨ Hashtable ã€‚

#### ä¸ºä»€ä¹ˆHashMapçš„å®¹é‡æ˜¯2çš„å¹‚æ¬¡ï¼Ÿ

1. å› ä¸ºä½è¿ç®—çš„é€Ÿåº¦æ¯”å–æ¨¡å¿«  
2. å¦‚æœè¦ä½¿ç”¨ä¸ºä½è¿ç®—å–æ¨¡é‚£ä¹ˆä½¿ç”¨è¿™ç§æ–¹å¼ï¼š return h & (length-1);   
3. ä½¿ç”¨è¿™ç§ä½è¿ç®—å–æ¨¡çš„æ–¹å¼ï¼Œåªæœ‰å½“å®¹é‡ä¸º2çš„å¹‚æ¬¡çš„æ—¶å€™ï¼Œæ‰èƒ½ä½¿ç”¨æ‰€æœ‰ç©ºé—´



####HashMapåœ¨å¹¶å‘æƒ…å†µä¸‹ä¼šå‡ºç°ä»€ä¹ˆç°è±¡

1ã€å¤šçº¿ç¨‹putæ“ä½œåï¼Œgetæ“ä½œå¯¼è‡´æ­»å¾ªç¯ã€‚
2ã€å¤šçº¿ç¨‹putéNULLå…ƒç´ åï¼Œgetæ“ä½œå¾—åˆ°NULLå€¼ã€‚
3ã€å¤šçº¿ç¨‹putæ“ä½œï¼Œå¯¼è‡´å…ƒç´ ä¸¢å¤±ã€‚

http://www.cnblogs.com/ITtangtang/p/3966467.html



####ConcurrentHashmapæ˜¯æ€ä¹ˆåšåˆ°çº¿ç¨‹å®‰å…¨çš„

1.7æ˜¯åŸºäº åˆ†æ®µé”ï¼Œä¹Ÿå°±æ˜¯ `Segment`      ,è¿™ä¸ªç±»ç»§æ‰¿ä¸        `ReentrantLock` ï¼Œå…¶putæ–¹æ³•ï¼Œç«å°è¯•è·å–é”

1.8ä¸­æ”¾å¼ƒäº†`Segment`è‡ƒè‚¿çš„è®¾è®¡ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯é‡‡ç”¨`Node` + `CAS` + `Synchronized`æ¥ä¿è¯å¹¶å‘å®‰å…¨è¿›è¡Œå®ç°ï¼Œ





####**ConcurrentHashmapçš„sizeå®ç°**

åœ¨ jdk 1.8 æä¾›äº†ä¸€ä¸ªæ–°çš„è®¡æ•°æ–¹æ³•`mappingCount `, å®ƒä»¥é•¿æ•´å‹longè¿”å›mapä¸­æ˜ å°„çš„æ•°ç›®ã€‚æˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨è¿™ä¸ªæ–°æ–¹æ³•ï¼Œè€Œä¸æ˜¯è€çš„sizeæ–¹æ³•ï¼Œ sizeæ–¹æ³•è¿”å›çš„ç±»å‹ä¸ºintã€‚ 











**hashmap put æ–¹æ³•å­˜æ”¾çš„æ—¶å€™æ€ä¹ˆåˆ¤æ–­æ˜¯å¦é‡å¤**



###å…¶ä»–

**Objectçš„hashcodeæ–¹æ³•é‡å†™äº†ï¼Œequalsæ–¹æ³•è¦ä¸è¦æ”¹ï¼Ÿ**

è¦ï¼Œå°±æ¯”å¦‚è¯´HashMapï¼Œåœ¨putçš„æ—¶å€™åˆ¤æ–­ï¼Œæ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯ï¼Œå…ˆæ¯”è¾ƒhash codeï¼Œç„¶åæ¯”è¾ƒæ˜¯å¦æ˜¯ç›´æ¥æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œæˆ–è€…equalsæ–¹æ³•

```java
if (e.hash == hash &&
    ((k = e.key) == key || (key != null && key.equals(k))))
  break;
```



------

**JDKä¸­æœ‰é‚£å‡ ä¸ªçº¿ç¨‹æ± ï¼Œé¡ºå¸¦æŠŠçº¿ç¨‹æ± è®²ä¸‹ï¼Ÿ**

```
FixedThreadPool
CachedThreadPool
ScheduledThreadPool
SingleThreadExecutor
```

å†…éƒ¨éƒ½æ˜¯åŸºäº `ThreadPoolExecutor` æ¥å®ç°çš„

å‡ ä¸ªé‡è¦çš„å‚æ•°

```
int corePoolSize,
int maximumPoolSize,
long keepAliveTime,
TimeUnit unit,
BlockingQueue<Runnable> workQueue,
ThreadFactory threadFactory
```

------

objectç±»ä¸­çš„æ–¹æ³•ï¼Ÿ

æ€»å…±12ä¸ªæ–¹æ³•

waitï¼ˆä¸‰ä¸ªï¼‰ã€notifyã€notifyAllã€hashcodeã€equlesã€toStringã€cloneã€getClassã€finalizeã€registerNatives

------

**åå°„çš„æœºåˆ¶**





## å¹¶å‘

###åç†è®º

####happens beforeåŸç†



####volatile å®ç°åŸç†

###å¹¶å‘åŒ…

#### åŸå­ç±»çš„åŸç†æ˜¯

1. åŒ…è£…çš„å€¼ä½¿ç”¨volitaleä¿®é¥°
2. é‡Œé¢çš„ä¸€äº›æ“ä½œä½¿ç”¨`æ­»å¾ªç¯`+unsafeçš„`cas`æ“ä½œï¼Œæ¯”å¦‚è‡ªå‡æ“ä½œ

```java
public final int getAndDecrement() {
  for (;;) {
    int current = get();
    int next = current - 1;
    if (compareAndSet(current, next))
      return current;
  }
}
```





####CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«

CountDownLatchï¼šä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–å¤šä¸ªçº¿ç¨‹å®ŒæˆæŸä»¶äº‹æƒ…ä¹‹åæ‰èƒ½æ‰§è¡Œ

CyclicBarrierï¼šå¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾åŒä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå†ç»§ç»­**ä¸€èµ·æ‰§è¡Œ**

```java
public class CyclicBarrierTest {
    public static void main(String[] args) {
        CyclicBarrier barrier = new CyclicBarrier(3);
        for(int i = 0; i < barrier.getParties(); i++){
            new Thread(new MyRunnable(barrier), "é˜Ÿå‹"+i).start();
        }
        System.out.println("main function is finished.");
    }


    private static class MyRunnable implements Runnable{
        private CyclicBarrier barrier;

        public MyRunnable(CyclicBarrier barrier){
            this.barrier = barrier;
        }

        @Override
        public void run() {
            for(int i = 0; i < 3; i++) {
                try {
                    Random rand = new Random();
                    int randomNum = rand.nextInt((3000 - 1000) + 1) + 1000;//äº§ç”Ÿ1000åˆ°3000ä¹‹é—´çš„éšæœºæ•´æ•°
                    Thread.sleep(randomNum);
                    System.out.println(Thread.currentThread().getName() + ", é€šè¿‡äº†ç¬¬"+i+"ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† "+((double)randomNum/1000)+"s");
                    this.barrier.await();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } catch (BrokenBarrierException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
```

æ‰§è¡Œç»“æœï¼š

```
main function is finished.
é˜Ÿå‹1, é€šè¿‡äº†ç¬¬0ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 1.432s
é˜Ÿå‹0, é€šè¿‡äº†ç¬¬0ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 1.465s
é˜Ÿå‹2, é€šè¿‡äº†ç¬¬0ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 2.26s
é˜Ÿå‹1, é€šè¿‡äº†ç¬¬1ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 1.542s
é˜Ÿå‹0, é€šè¿‡äº†ç¬¬1ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 2.154s
é˜Ÿå‹2, é€šè¿‡äº†ç¬¬1ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 2.556s
é˜Ÿå‹1, é€šè¿‡äº†ç¬¬2ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 1.426s
é˜Ÿå‹2, é€šè¿‡äº†ç¬¬2ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 2.603s
é˜Ÿå‹0, é€šè¿‡äº†ç¬¬2ä¸ªéšœç¢ç‰©, ä½¿ç”¨äº† 2.784s
```

#### ArrayBlockingQueue

å…³é”®ç‚¹ï¼š

1. ä½¿ç”¨`final Object[] items;`æ¥å­˜æ”¾æ•°æ®ï¼Œä½¿ç”¨`int takeIndex;`, å’Œ `int putIndex;`æ¥åˆ†åˆ«è®°å½•å­˜å’Œå–çš„è®°å½•ï¼Œä½¿ç”¨`int count;`æ¥è®°å½•é˜Ÿåˆ—ä¸­æ•°æ®çš„æ•°é‡
2. 

### å®æ“é¢˜

#### ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œä¸€ä¸ªè¾“å‡ºå¥‡æ•°ï¼Œä¸€ä¸ªè¾“å‡ºå¶æ•°

æˆ‘ä»¬ä½¿ç”¨ volatile å˜é‡ä»£æ›¿ CAS å˜é‡ï¼Œå‡è½»ä½¿ç”¨ CAS çš„æ¶ˆè€—ï¼Œæ³¨æ„ï¼Œè¿™é‡Œ ++num ä¸æ˜¯åŸå­çš„ï¼Œä½†ä¸å¦¨ç¢ï¼Œå› ä¸ºæœ‰ flag å˜é‡æ§åˆ¶ã€‚è€Œ num å¿…é¡»æ˜¯ volatile çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œä¼šå¯¼è‡´å¯è§æ€§é—®é¢˜ã€‚

```java
public class ThreadPrintDemo3 {
    
    static volatile int num = 0;
    static volatile boolean flag = false;

    public static void main(String[] args) {

        Thread t1 = new Thread(() -> {
            for (; 100 > num; ) {
                if (!flag && (num == 0 || ++num % 2 == 0)) {
                    System.out.println(Thread.currentThread() + " ï¼š" + num);
                    flag = true;
                }
            }
        }
        );

        Thread t2 = new Thread(() -> {
            for (; 100 > num; ) {
                if (flag && (++num % 2 != 0)) {
                    System.out.println(Thread.currentThread() + " ï¼š" + num);
                    flag = false;
                }
            }
        }
        );
        t1.start();
        t2.start();
    }
}
```



##æ•°æ®åº“



###Mysql

#### B+æ ‘ã€B-æ ‘çš„åŒºåˆ«

é¦–å…ˆBæ ‘å°±æ˜¯B-æ ‘

**ä¸€ä¸ª m é˜¶çš„Bæ ‘æ˜¯ä¸€ä¸ªæœ‰ä»¥ä¸‹å±æ€§çš„æ ‘ï¼š**

1. æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ m ä¸ªå­èŠ‚ç‚¹
2. æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼ˆé™¤æ ¹èŠ‚ç‚¹ï¼‰æœ€å°‘æœ‰ âŒˆm/2âŒ‰ ä¸ªå­èŠ‚ç‚¹
3. å¦‚æœæ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒè‡³å°‘æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹
4. æœ‰ k ä¸ªå­èŠ‚ç‚¹çš„éå¶å­èŠ‚ç‚¹æ‹¥æœ‰ k âˆ’ 1 ä¸ªé”®
5. æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚

**Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«**

1. B+æ ‘ä¸­åªæœ‰å¶å­èŠ‚ç‚¹ä¼šå¸¦æœ‰æŒ‡å‘è®°å½•çš„æŒ‡é’ˆï¼Œè€ŒBæ ‘åˆ™æ‰€æœ‰èŠ‚ç‚¹éƒ½å¸¦æœ‰ï¼Œåœ¨å†…éƒ¨èŠ‚ç‚¹å‡ºç°çš„ç´¢å¼•é¡¹ä¸ä¼šå†å‡ºç°åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚
2. B+æ ‘ä¸­æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½æ˜¯é€šè¿‡æŒ‡é’ˆè¿æ¥åœ¨ä¸€èµ·ï¼Œè€ŒBæ ‘ä¸ä¼šã€‚

**B+æ ‘ä¼˜ç‚¹ï¼š**

1. ä¸­é—´èŠ‚ç‚¹å…¨æ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥é™ä½æ ‘çš„é«˜åº¦ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸€ä¸ªä¸­é—´èŠ‚ç‚¹å¯ä»¥ç´¢å¼•åˆ°æ›´å¤šçš„è®°å½•
2. å¯ä»¥ç›´æ¥åœ¨å¶å­èŠ‚ç‚¹å±‚æ¨ªå‘éå†ï¼Œbæ ‘æƒ³è¦éå†åˆ™éœ€è¦å¶å­èŠ‚ç‚¹å’Œä¸Šå±‚èŠ‚ç‚¹ä¸åœå¾€è¿”ã€‚



####æŸ¥çœ‹SQLæ˜¯ä¸æ˜¯ä½¿ç”¨äº†ç´¢å¼•ï¼Œæœ‰å“ªäº›å·¥å…·

mysql çš„ explain å‘½ä»¤ï¼Œå­—æ®µkeyå¦‚æœä¸ºnull ï¼Œè¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨ç´¢å¼•



#### select for update æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œä¼šé”è¡¨è¿˜æ˜¯é”è¡Œæˆ–æ˜¯å…¶ä»–



####SQLä¼˜åŒ–çš„å¸¸è§æ–¹æ³•æœ‰å“ªäº›

1. å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚ 
2. åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼šselect id from t where num is nullå¯ä»¥åœ¨numä¸Šè®¾ç½®é»˜è®¤å€¼0ï¼Œç¡®ä¿è¡¨ä¸­numåˆ—æ²¡æœ‰nullå€¼ï¼Œç„¶åè¿™æ ·æŸ¥è¯¢ï¼šselect id from t where num=0 
3. åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–<>æ“ä½œç¬¦ï¼Œå¦åˆ™å¼•æ“å°†æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚ 
4. åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼šselect id from t where num=10 or num=20å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼šselect id from t where num=10 union all select id from t where num=20 
5. in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¦‚ï¼šselect id from t where num in(1,2,3) å¯¹äºè¿ç»­çš„æ•°å€¼ï¼Œèƒ½ç”¨ between å°±ä¸è¦ç”¨ in äº†ï¼šselect id from t where num between 1 and 3 
6. é¿å…ä½¿ç”¨é€šé…ç¬¦ã€‚ä¸‹é¢çš„æŸ¥è¯¢ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æï¼šselect id from t where name like â€˜æ%â€™è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘å…¨æ–‡æ£€ç´¢ã€‚ 
7. å¦‚æœåœ¨ where å­å¥ä¸­ä½¿ç”¨å‚æ•°ï¼Œä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚å› ä¸ºSQLåªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šè§£æå±€éƒ¨å˜é‡ï¼Œä½†ä¼˜åŒ–ç¨‹åºä¸èƒ½å°†è®¿é—®è®¡åˆ’çš„é€‰æ‹©æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ï¼›å®ƒå¿…é¡»åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé€‰æ‹©ã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶å»ºç«‹è®¿é—®è®¡åˆ’ï¼Œå˜é‡çš„å€¼è¿˜æ˜¯æœªçŸ¥çš„ï¼Œå› è€Œæ— æ³•ä½œä¸ºç´¢å¼•é€‰æ‹©çš„è¾“å…¥é¡¹ã€‚å¦‚ä¸‹é¢è¯­å¥å°†è¿›è¡Œå…¨è¡¨æ‰«æï¼šselect id from t where num=@numå¯ä»¥æ”¹ä¸ºå¼ºåˆ¶æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼šselect id from t with(index(ç´¢å¼•å)) where num=@num 
8. åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼šselect id from t where num/2=100åº”æ”¹ä¸º:select id from t where num=100*2 
9. åº”å°½é‡é¿å…åœ¨whereå­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼šselect id from t where substring(name,1,3)=â€™abcâ€™ ï¼Œnameä»¥abcå¼€å¤´çš„idåº”æ”¹ä¸º:select id from t where name like â€˜abc%â€™ 
10. ä¸è¦åœ¨ where å­å¥ä¸­çš„â€œ=â€å·¦è¾¹è¿›è¡Œå‡½æ•°ã€ç®—æœ¯è¿ç®—æˆ–å…¶ä»–è¡¨è¾¾å¼è¿ç®—ï¼Œå¦åˆ™ç³»ç»Ÿå°†å¯èƒ½æ— æ³•æ­£ç¡®ä½¿ç”¨ç´¢å¼•
11. åœ¨ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæ¡ä»¶æ—¶ï¼Œå¦‚æœè¯¥ç´¢å¼•æ˜¯å¤åˆç´¢å¼•ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨åˆ°è¯¥ç´¢å¼•ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µä½œä¸ºæ¡ä»¶æ—¶æ‰èƒ½ä¿è¯ç³»ç»Ÿä½¿ç”¨è¯¥ç´¢å¼•ï¼Œå¦åˆ™è¯¥ç´¢å¼•å°†ä¸ä¼šè¢«ä½¿ç”¨ï¼Œå¹¶ä¸”åº”å°½å¯èƒ½çš„è®©å­—æ®µé¡ºåºä¸ç´¢å¼•é¡ºåºç›¸ä¸€è‡´ã€‚ 
12. ä¸è¦å†™ä¸€äº›æ²¡æœ‰æ„ä¹‰çš„æŸ¥è¯¢ï¼Œå¦‚éœ€è¦ç”Ÿæˆä¸€ä¸ªç©ºè¡¨ç»“æ„ï¼šselect col1,col2 into #t from t where 1=0 è¿™ç±»ä»£ç ä¸ä¼šè¿”å›ä»»ä½•ç»“æœé›†ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºçš„ï¼Œåº”æ”¹æˆè¿™æ ·ï¼šcreate table #t(â€¦) 
13. å¾ˆå¤šæ—¶å€™ç”¨ exists ä»£æ›¿ in æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼šselect num from a where num in(select num from b)ç”¨ä¸‹é¢çš„è¯­å¥æ›¿æ¢ï¼šselect num from a where exists(select 1 from b where num=a.num) 
14. å¹¶ä¸æ˜¯æ‰€æœ‰ç´¢å¼•å¯¹æŸ¥è¯¢éƒ½æœ‰æ•ˆï¼ŒSQLæ˜¯æ ¹æ®è¡¨ä¸­æ•°æ®æ¥è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–çš„ï¼Œå½“ç´¢å¼•åˆ—æœ‰å¤§é‡æ•°æ®é‡å¤æ—¶ï¼ŒSQLæŸ¥è¯¢å¯èƒ½ä¸ä¼šå»åˆ©ç”¨ç´¢å¼•ï¼Œå¦‚ä¸€è¡¨ä¸­æœ‰å­—æ®µsexï¼Œmaleã€femaleå‡ ä¹å„ä¸€åŠï¼Œé‚£ä¹ˆå³ä½¿åœ¨sexä¸Šå»ºäº†ç´¢å¼•ä¹Ÿå¯¹æŸ¥è¯¢æ•ˆç‡èµ·ä¸äº†ä½œç”¨ã€‚ 
15. ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œç´¢å¼•å›ºç„¶å¯ä»¥æé«˜ç›¸åº”çš„ select çš„æ•ˆç‡ï¼Œä½†åŒæ—¶ä¹Ÿé™ä½äº†insert åŠ update çš„ æ•ˆç‡ï¼Œå› ä¸º insert æˆ– update æ—¶æœ‰å¯èƒ½ä¼šé‡å»ºç´¢å¼•ï¼Œæ‰€ä»¥æ€æ ·å»ºç´¢å¼•éœ€è¦æ…é‡è€ƒè™‘ï¼Œè§†å…·ä½“æƒ…å†µè€Œå®šã€‚ä¸€ä¸ªè¡¨çš„ç´¢å¼•æ•°æœ€å¥½ä¸è¦è¶…è¿‡6ä¸ªï¼Œè‹¥å¤ªå¤šåˆ™åº”è€ƒè™‘ä¸€äº›ä¸å¸¸ä½¿ç”¨åˆ°çš„åˆ—ä¸Šå»ºçš„ç´¢å¼•æ˜¯å¦æœ‰ å¿…è¦ã€‚ 
16. åº”å°½å¯èƒ½çš„é¿å…æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œå› ä¸º clustered ç´¢å¼•æ•°æ®åˆ—çš„é¡ºåºå°±æ˜¯è¡¨è®°å½•çš„ç‰©ç†å­˜å‚¨ é¡ºåºï¼Œä¸€æ—¦è¯¥åˆ—å€¼æ”¹å˜å°†å¯¼è‡´æ•´ä¸ªè¡¨è®°å½•çš„é¡ºåºçš„è°ƒæ•´ï¼Œä¼šè€—è´¹ç›¸å½“å¤§çš„èµ„æºã€‚è‹¥åº”ç”¨ç³»ç»Ÿéœ€è¦é¢‘ç¹æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œé‚£ä¹ˆéœ€è¦è€ƒè™‘æ˜¯å¦åº”å°†è¯¥ç´¢å¼•å»ºä¸º clustered ç´¢å¼•ã€‚ 
17. å°½é‡ä½¿ç”¨æ•°å­—å‹å­—æ®µï¼Œè‹¥åªå«æ•°å€¼ä¿¡æ¯çš„å­—æ®µå°½é‡ä¸è¦è®¾è®¡ä¸ºå­—ç¬¦å‹ï¼Œè¿™ä¼šé™ä½æŸ¥è¯¢å’Œè¿æ¥çš„æ€§èƒ½ï¼Œå¹¶ä¼šå¢åŠ å­˜å‚¨å¼€é”€ã€‚è¿™æ˜¯å› ä¸ºå¼•æ“åœ¨å¤„ç†æŸ¥è¯¢å’Œè¿æ¥æ—¶ä¼šé€ä¸ªæ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œå¯¹äºæ•°å­—å‹è€Œè¨€åªéœ€è¦æ¯”è¾ƒä¸€æ¬¡å°±å¤Ÿäº†ã€‚ 
18. å°½å¯èƒ½çš„ä½¿ç”¨ varchar/nvarchar ä»£æ›¿ char/nchar ï¼Œå› ä¸ºé¦–å…ˆå˜é•¿å­—æ®µå­˜å‚¨ç©ºé—´å°ï¼Œå¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå…¶æ¬¡å¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å­—æ®µå†…æœç´¢æ•ˆç‡æ˜¾ç„¶è¦é«˜äº›ã€‚ 
19. ä»»ä½•åœ°æ–¹éƒ½ä¸è¦ä½¿ç”¨ select * from t ï¼Œç”¨å…·ä½“çš„å­—æ®µåˆ—è¡¨ä»£æ›¿â€œ*â€ï¼Œä¸è¦è¿”å›ç”¨ä¸åˆ°çš„ä»»ä½•å­—æ®µã€‚ 
20. å°½é‡ä½¿ç”¨è¡¨å˜é‡æ¥ä»£æ›¿ä¸´æ—¶è¡¨ã€‚å¦‚æœè¡¨å˜é‡åŒ…å«å¤§é‡æ•°æ®ï¼Œè¯·æ³¨æ„ç´¢å¼•éå¸¸æœ‰é™ï¼ˆåªæœ‰ä¸»é”®ç´¢å¼•ï¼‰ã€‚ 
21. é¿å…é¢‘ç¹åˆ›å»ºå’Œåˆ é™¤ä¸´æ—¶è¡¨ï¼Œä»¥å‡å°‘ç³»ç»Ÿè¡¨èµ„æºçš„æ¶ˆè€—ã€‚ 
22. ä¸´æ—¶è¡¨å¹¶ä¸æ˜¯ä¸å¯ä½¿ç”¨ï¼Œé€‚å½“åœ°ä½¿ç”¨å®ƒä»¬å¯ä»¥ä½¿æŸäº›ä¾‹ç¨‹æ›´æœ‰æ•ˆï¼Œä¾‹å¦‚ï¼Œå½“éœ€è¦é‡å¤å¼•ç”¨å¤§å‹è¡¨æˆ–å¸¸ç”¨è¡¨ä¸­çš„æŸä¸ªæ•°æ®é›†æ—¶ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€æ¬¡æ€§äº‹ä»¶ï¼Œæœ€å¥½ä½¿ç”¨å¯¼å‡ºè¡¨ã€‚ 
23. åœ¨æ–°å»ºä¸´æ—¶è¡¨æ—¶ï¼Œå¦‚æœä¸€æ¬¡æ€§æ’å…¥æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ select into ä»£æ›¿ create tableï¼Œé¿å…é€ æˆå¤§é‡ log ï¼Œä»¥æé«˜é€Ÿåº¦ï¼›å¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œä¸ºäº†ç¼“å’Œç³»ç»Ÿè¡¨çš„èµ„æºï¼Œåº”å…ˆcreate tableï¼Œç„¶åinsertã€‚ 
24. å¦‚æœä½¿ç”¨åˆ°äº†ä¸´æ—¶è¡¨ï¼Œåœ¨å­˜å‚¨è¿‡ç¨‹çš„æœ€ååŠ¡å¿…å°†æ‰€æœ‰çš„ä¸´æ—¶è¡¨æ˜¾å¼åˆ é™¤ï¼Œå…ˆ truncate table ï¼Œç„¶å drop table ï¼Œè¿™æ ·å¯ä»¥é¿å…ç³»ç»Ÿè¡¨çš„è¾ƒé•¿æ—¶é—´é”å®šã€‚ 
25. å°½é‡é¿å…ä½¿ç”¨æ¸¸æ ‡ï¼Œå› ä¸ºæ¸¸æ ‡çš„æ•ˆç‡è¾ƒå·®ï¼Œå¦‚æœæ¸¸æ ‡æ“ä½œçš„æ•°æ®è¶…è¿‡1ä¸‡è¡Œï¼Œé‚£ä¹ˆå°±åº”è¯¥è€ƒè™‘æ”¹å†™ã€‚ 
26. ä½¿ç”¨åŸºäºæ¸¸æ ‡çš„æ–¹æ³•æˆ–ä¸´æ—¶è¡¨æ–¹æ³•ä¹‹å‰ï¼Œåº”å…ˆå¯»æ‰¾åŸºäºé›†çš„è§£å†³æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜ï¼ŒåŸºäºé›†çš„æ–¹æ³•é€šå¸¸æ›´æœ‰æ•ˆã€‚ 
27. ä¸ä¸´æ—¶è¡¨ä¸€æ ·ï¼Œæ¸¸æ ‡å¹¶ä¸æ˜¯ä¸å¯ä½¿ç”¨ã€‚å¯¹å°å‹æ•°æ®é›†ä½¿ç”¨ FAST_FORWARD æ¸¸æ ‡é€šå¸¸è¦ä¼˜äºå…¶ä»–é€è¡Œå¤„ç†æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨å¿…é¡»å¼•ç”¨å‡ ä¸ªè¡¨æ‰èƒ½è·å¾—æ‰€éœ€çš„æ•°æ®æ—¶ã€‚åœ¨ç»“æœé›†ä¸­åŒ…æ‹¬â€œåˆè®¡â€çš„ä¾‹ç¨‹é€šå¸¸è¦æ¯”ä½¿ç”¨æ¸¸æ ‡æ‰§è¡Œçš„é€Ÿåº¦å¿«ã€‚å¦‚æœå¼€å‘æ—¶é—´å…è®¸ï¼ŒåŸºäºæ¸¸æ ‡çš„æ–¹æ³•å’ŒåŸºäºé›†çš„æ–¹æ³•éƒ½å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œçœ‹å“ªä¸€ç§æ–¹æ³•çš„æ•ˆæœæ›´å¥½ã€‚ 
28. åœ¨æ‰€æœ‰çš„å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨çš„å¼€å§‹å¤„è®¾ç½® SET NOCOUNT ON ï¼Œåœ¨ç»“æŸæ—¶è®¾ç½® SET NOCOUNT OFFã€‚æ— éœ€åœ¨æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨çš„æ¯ä¸ªè¯­å¥åå‘å®¢æˆ·ç«¯å‘é€DONE_IN_PROC æ¶ˆæ¯ã€‚ 
29. å°½é‡é¿å…å¤§äº‹åŠ¡æ“ä½œï¼Œæé«˜ç³»ç»Ÿå¹¶å‘èƒ½åŠ›ã€‚ 
30. å°½é‡é¿å…å‘å®¢æˆ·ç«¯è¿”å›å¤§æ•°æ®é‡ï¼Œè‹¥æ•°æ®é‡è¿‡å¤§ï¼Œåº”è¯¥è€ƒè™‘ç›¸åº”éœ€æ±‚æ˜¯å¦åˆç†ã€‚


#### èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•çš„åŒºåˆ«

èšé›†ç´¢å¼•(èšç°‡ç´¢å¼•æˆ–è€…ä¸»é”®ç´¢å¼•):å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æ•´å¼ è¡¨çš„è¡Œè®°å½•æ•°æ®

éèšé›†ç´¢å¼•(äºŒçº§ç´¢å¼•æˆ–è€…éä¸»é”®ç´¢å¼•):å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼,æ‰€ä»¥ä½¿ç”¨æ­¤ç±»ç´¢å¼•åï¼Œ**å›åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå›è¡¨**



#### ç´¢å¼•ä»€ä¹ˆæ—¶å€™ä¼šå¤±æ•ˆå˜æˆå…¨è¡¨æ‰«æ

#### Mysqlæ€§èƒ½ä¼˜åŒ–

**å¯ä»¥ä»å¦‚ä¸‹çš„æ–¹å‘æå‡mysqlçš„æ€§èƒ½ï¼š**

è®¾è®¡æ•°æ®åº“æ—¶ï¼šæ•°æ®åº“è¡¨ã€å­—æ®µçš„è®¾è®¡ï¼Œå­˜å‚¨å¼•æ“

åˆ©ç”¨å¥½MySQLè‡ªèº«æä¾›çš„åŠŸèƒ½ï¼Œå¦‚ç´¢å¼•ç­‰

æ¨ªå‘æ‰©å±•ï¼šMySQLé›†ç¾¤ã€è´Ÿè½½å‡è¡¡ã€è¯»å†™åˆ†ç¦»

SQLè¯­å¥çš„ä¼˜åŒ–ï¼ˆæ”¶æ•ˆç”šå¾®ï¼‰



1. å¢å¤§ join_buffer_size çš„æ•°å€¼ï¼Œä¹Ÿå°±æ˜¯è¡¨å’Œè¡¨è”æ¥çš„ç¼“å†²åŒºçš„å¤§å°ï¼Œåœ¨åšjoinæ“ä½œçš„æ—¶å€™ä¼šæŠŠé©±åŠ¨è¡¨çš„ç›¸åº”æ•°æ®åŠ è½½è¿›å…¥  joinbuffer ä¸­ï¼Œ åœ¨ä½¿ç”¨joinçš„æ—¶å€™ï¼ŒåŸºäºè¢«é©±åŠ¨è¡¨æ˜¯å¦æœ‰ç´¢å¼•æœ‰ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ Index Nested-Loop Join  å’Œ Block Nested-Loop Joinï¼Œåè€…è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•ï¼Œå¦‚æœåœ¨åè€…çš„æƒ…å†µï¼Œå¦‚æœjoin-buffer ä¸å¤Ÿå¤§ï¼Œä¸€æ¬¡åªèƒ½åŠ è½½éƒ¨åˆ†çš„é©±åŠ¨è¡¨ï¼Œä½†æ˜¯ç›¸åº”çš„è¢«é©±åŠ¨è¡¨å°±è¦å…¨è¡¨æ‰«æä¸€æ¬¡ï¼Œæ‰€ä»¥å¢åŠ æ­¤buffer èƒ½é™ä½è¢«é©±åŠ¨è¡¨çš„å…¨è¡¨æ‰«ææ¬¡æ•°ä»è€Œæå‡æ€§èƒ½

**SQLç´¢å¼•çš„é¡ºåºï¼Œå­—æ®µçš„é¡ºåº**

åŸºäºç´¢å¼•çš„æœ€å·¦åŒ¹é…ç‰¹æ€§ï¼Ÿ



####ä»€ä¹ˆæ˜¯ MVCC ï¼Ÿ

å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCC **Multi-Version Concurrency Control**ï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨æ¥**è§£å†³è¯»-å†™å†²çª**çš„æ— é”å¹¶å‘æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº‹åŠ¡åˆ†é…å•å‘å¢é•¿çš„æ—¶é—´æˆ³ï¼Œä¸ºæ¯ä¸ªä¿®æ”¹ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸äº‹åŠ¡æ—¶é—´æˆ³å…³è”ï¼Œè¯»æ“ä½œåªè¯»è¯¥äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®åº“çš„å¿«ç…§ã€‚ è¿™æ ·åœ¨è¯»æ“ä½œä¸ç”¨é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¸ç”¨é˜»å¡è¯»æ“ä½œçš„åŒæ—¶ï¼Œé¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»ã€‚

//TODO

------

**ä¸å¯é‡å¤éƒ½å‡ºç°åœ¨ä»€ä¹ˆåœºæ™¯**

------

**mysqläº‹ç‰©åˆéš”ç¦»æ€§å’Œéš”ç¦»çº§åˆ«**

------

### Redis

#### ä¸ºä»€ä¹ˆ Redis å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½æ•ˆç‡è¿™ä¹ˆé«˜ï¼Ÿ

- 1ã€çº¯å†…å­˜æ“ä½œã€‚

  > Redis ä¸ºäº†è¾¾åˆ°æœ€å¿«çš„è¯»å†™é€Ÿåº¦ï¼Œå°†æ•°æ®éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®å†™å…¥ç£ç›˜ã€‚æ‰€ä»¥ Redis å…·æœ‰å¿«é€Ÿå’Œæ•°æ®æŒä¹…åŒ–çš„ç‰¹å¾ã€‚
  >
  > å¦‚æœä¸å°†æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œç£ç›˜ I/O é€Ÿåº¦ä¸ºä¸¥é‡å½±å“ Redis çš„æ€§èƒ½ã€‚

- 2ã€æ ¸å¿ƒæ˜¯åŸºäºéé˜»å¡çš„ IO å¤šè·¯å¤ç”¨æœºåˆ¶ã€‚

- 3ã€å•çº¿ç¨‹åè€Œé¿å…äº†å¤šçº¿ç¨‹çš„é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ã€‚

  > Redis åˆ©ç”¨é˜Ÿåˆ—æŠ€æœ¯ï¼Œå°†å¹¶å‘è®¿é—®å˜ä¸ºä¸²è¡Œè®¿é—®ï¼Œæ¶ˆé™¤äº†ä¼ ç»Ÿæ•°æ®åº“ä¸²è¡Œæ§åˆ¶çš„å¼€é”€

- 4ã€Redis å…¨ç¨‹ä½¿ç”¨ hash ç»“æ„ï¼Œè¯»å–é€Ÿåº¦å¿«ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå¯¹æ•°æ®å­˜å‚¨è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¦‚å‹ç¼©è¡¨ï¼Œå¯¹çŸ­æ•°æ®è¿›è¡Œå‹ç¼©å­˜å‚¨ï¼Œå†å¦‚ï¼Œè·³è¡¨ï¼Œä½¿ç”¨æœ‰åºçš„æ•°æ®ç»“æ„åŠ å¿«è¯»å–çš„é€Ÿåº¦ã€‚



## ä¸­é—´ä»¶

### RocketMQ

#### æ¶ˆæ¯é˜Ÿåˆ—æœ‰å‡ ç§æŠ•é€’æ–¹å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹

æ¶ˆæ¯é˜Ÿåˆ—æœ‰ **push æ¨é€**å’Œ **pull æ‹‰å–**ä¸¤ç§æŠ•é€’æ–¹å¼

- push 
  - ä¼˜ç‚¹ï¼Œå°±æ˜¯åŠæ—¶æ€§ã€‚
  - ç¼ºç‚¹ï¼Œå°±æ˜¯å—é™äºæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›ï¼Œå¯èƒ½é€ æˆæ¶ˆæ¯çš„å †ç§¯ï¼ŒBroker ä¼šä¸æ–­ç»™æ¶ˆè´¹è€…å‘é€ä¸èƒ½å¤„ç†çš„æ¶ˆæ¯ã€‚
- pull
  - ä¼˜ç‚¹ï¼Œå°±æ˜¯ä¸»åŠ¨æƒæŒæ¡åœ¨æ¶ˆè´¹æ–¹ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„æ¶ˆæ¯é€Ÿåº¦è¿›è¡Œæ¶ˆæ¯æ‹‰å–ã€‚
  - ç¼ºç‚¹ï¼Œå°±æ˜¯æ¶ˆè´¹æ–¹ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å¯ä»¥è·å–çš„æœ€æ–°çš„æ¶ˆæ¯ï¼Œä¼šæœ‰æ¶ˆæ¯å»¶è¿Ÿå’Œå¿™ç­‰ã€‚

ç›®å‰çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œ**åŸºäº push + pull æ¨¡å¼ç»“åˆçš„æ–¹å¼**ï¼ŒBroker ä»…ä»…å‘Šè¯‰ Consumer æœ‰æ–°çš„æ¶ˆæ¯ï¼Œå…·ä½“çš„æ¶ˆæ¯æ‹‰å–ï¼Œè¿˜æ˜¯ Consumer è‡ªå·±ä¸»åŠ¨æ‹‰å–ã€‚



### Kafka

#### ä¸ºä»€ä¹ˆkafkaè¿™ä¹ˆå¿«ï¼Œåˆèƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ

##### å¦‚ä½•åšåˆ°æ¶ˆæ¯ä¸ä¸¢å¤±

**ACK æœºåˆ¶**

é€šè¿‡ ACK æœºåˆ¶ä¿è¯æ¶ˆæ¯é€è¾¾ã€‚Kafka é‡‡ç”¨çš„æ˜¯è‡³å°‘ä¸€æ¬¡ï¼ˆAt least onceï¼‰ï¼Œæ¶ˆæ¯ä¸ä¼šä¸¢ï¼Œä½†æ˜¯å¯èƒ½ä¼šé‡å¤ä¼ è¾“ã€‚

**å‘é€æ¶ˆæ¯**

ä¸ºäº†å¾—åˆ°æ›´å¥½çš„æ€§èƒ½ï¼ŒKafka æ”¯æŒåœ¨ç”Ÿäº§è€…ä¸€ä¾§è¿›è¡Œæœ¬åœ°bufferï¼Œä¹Ÿå°±æ˜¯ç´¯ç§¯åˆ°ä¸€å®šçš„æ¡æ•°æ‰å‘é€ï¼Œå¦‚æœè¿™é‡Œè®¾ç½®ä¸å½“æ˜¯ä¼šä¸¢æ¶ˆæ¯çš„ã€‚

ç”Ÿäº§è€…ç«¯è®¾ç½® producer.type=async, syncï¼Œé»˜è®¤æ˜¯ syncã€‚

å½“è®¾ç½®ä¸º asyncï¼Œä¼šå¤§å¹…æå‡æ€§èƒ½ï¼Œå› ä¸ºç”Ÿäº§è€…ä¼šåœ¨æœ¬åœ°ç¼“å†²æ¶ˆæ¯ï¼Œå¹¶é€‚æ—¶æ‰¹é‡å‘é€ã€‚

å¦‚æœå¯¹å¯é æ€§è¦æ±‚é«˜ï¼Œé‚£ä¹ˆè¿™é‡Œå¯ä»¥è®¾ç½®ä¸º sync åŒæ­¥å‘é€ã€‚

**æ¶ˆè´¹æ¶ˆæ¯**

å¦‚æœæ›´æ³¨é‡å¯é æ€§ï¼Œåˆ™éœ€è¦æ˜¾ç¤ºæäº¤ Offsetï¼Œä¹Ÿå°±æ˜¯å½“æ‰€æœ‰ä¸šåŠ¡éƒ½å¤„ç†å®Œæˆçš„æ—¶å€™ï¼Œå†æäº¤ Offsetã€‚è¿™æ ·ä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹ï¼Œéœ€è¦æä¾›å¹‚ç­‰æ€§æ¥å£ã€‚

##### ä¸ºä»€ä¹ˆ Kafka æ€§èƒ½é«˜ï¼Ÿ

**é¡ºåºå†™ç£ç›˜**

é¡ºåºå†™ç£ç›˜çš„æ€§èƒ½æ˜¯éšæœºå†™å…¥çš„æ€§èƒ½çš„6000å€çš„æå‡ï¼Œåª²ç¾å†…å­˜éšæœºè®¿é—®çš„æ€§èƒ½ï¼Œç£ç›˜ä¸å†æ˜¯ç“¶é¢ˆç‚¹ã€‚

**Page Cache**

ä¸ºäº†ä¼˜åŒ–è¯»å†™æ€§èƒ½ï¼ŒKafkaåˆ©ç”¨äº†æ“ä½œç³»ç»Ÿæœ¬èº«çš„Page Cacheï¼Œå°±æ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿè‡ªèº«çš„å†…å­˜è€Œä¸æ˜¯JVMç©ºé—´å†…å­˜ã€‚é€šè¿‡æ“ä½œç³»ç»Ÿçš„Page Cacheï¼ŒKafkaçš„è¯»å†™æ“ä½œåŸºæœ¬ä¸Šæ˜¯åŸºäºå†…å­˜çš„ï¼Œè¯»å†™é€Ÿåº¦å¾—åˆ°äº†æå¤§çš„æå‡ã€‚

**é›¶æ‹·è´æŠ€æœ¯**

é›¶æ‹·è´æŠ€æœ¯ï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ‹·è´æ¬¡æ•°ã€‚

kafkaçš„è®¾è®¡å®ç°ï¼Œæ¶‰åŠåˆ°å¾ˆå¤šçš„åº•å±‚æŠ€æœ¯ï¼Œä¸ºäº†èƒ½å¤ŸæŠŠå®ƒåƒé€ï¼Œéœ€è¦èŠ±å¤§é‡çš„æ—¶é—´ï¼Œå¤§é‡çš„ç²¾åŠ›ã€‚

#### ä¸ºä»€ä¹ˆKafkaä¸æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Ÿ



## ç®—æ³•ä¸æ•°æ®ç»“æ„

**è¯´ä¸‹ä½ çŸ¥é“çš„æ’åºç®—æ³•**

### çº¢é»‘æ ‘

**çº¢é»‘æ ‘ç‰¹ç‚¹:**

1.èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²ã€‚

2.æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚

3.æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNULLèŠ‚ç‚¹ï¼‰ã€‚

4 æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ã€‚(ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹)

5.ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚



**çº¢é»‘æ ‘çš„åº”ç”¨ï¼š**

TreeMapã€TreeSetä»¥åŠJDK1.8ä¹‹åçš„HashMapåº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ï¼Œä»¥åŠLinuxè™šæ‹Ÿå†…å­˜çš„ç®¡ç†ï¼Œéƒ½æ˜¯é€šè¿‡çº¢é»‘æ ‘å»å®ç°çš„ã€‚

ä¸é”™çš„æ–‡ç« ï¼š

[å¯»æ‰¾çº¢é»‘æ ‘çš„æ“ä½œæ‰‹å†Œ](http://dandanlove.com/2018/03/18/red-black-tree/)

[çº¢é»‘æ ‘æ·±å…¥å‰–æåŠJavaå®ç°-ç¾å›¢](https://zhuanlan.zhihu.com/p/24367771)

[æ¼«ç”»ï¼šä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ](https://juejin.im/post/5a27c6946fb9a04509096248#comment)

### å¸ƒéš†è¿‡æ»¤å™¨

1. é¦–å…ˆæ˜¯ä¸€ä¸ªbigmapæ¥å­˜æ”¾
2. å¤šä¸ªHash å‡½æ•°æ¥hash Keyï¼ŒæŠŠæ¯ä¸ªhashç»“æœå¯¹åº”ä½ç½®ç½®ä¸º0ï¼Œ
3. åœ¨åšisExistæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœå¤šä¸ªhashç»“æœä½ç½®ä¸Šæœ‰ä¸€ä¸ªä¸º0ï¼Œå°±è¡¨ç¤ºæ­¤keyä¸å­˜åœ¨
4. å¸ƒéš†è¿‡æ»¤å™¨ï¼Œåªèƒ½ç¡®å®šä¸å­˜åœ¨å’Œå¯èƒ½å­˜åœ¨ï¼Œä¸èƒ½åˆ é™¤key

## ç¼“å­˜

### è¯·è¯´è¯´æœ‰å“ªäº›ç¼“å­˜ç®—æ³•ï¼Ÿæ˜¯å¦èƒ½æ‰‹å†™ä¸€ä¸‹ LRU ä»£ç çš„å®ç°ï¼Ÿ

ç¼“å­˜ç®—æ³•ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯ä¸‰ç§ï¼š

- LRUï¼ˆleast recently used ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨)
- LFUï¼ˆLeast Frequently used ï¼Œæœ€ä¸ç»å¸¸ä½¿ç”¨)
- FIFOï¼ˆfirst in first out ï¼Œå…ˆè¿›å…ˆå‡º)

### ç”¨äº†ç¼“å­˜ä¹‹åï¼Œæœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿ

å¸¸è§çš„é—®é¢˜ï¼Œå¯åˆ—ä¸¾å¦‚ä¸‹ï¼š

- ç¼“å­˜ä½•æ—¶**å†™å…¥**ï¼Ÿå¹¶ä¸”å†™æ—¶å¦‚ä½•é¿å…å¹¶å‘é‡å¤å†™å…¥ï¼Ÿ
- ç¼“å­˜å¦‚ä½•**å¤±æ•ˆ**ï¼Ÿ
- ç¼“å­˜å’Œ DB çš„**ä¸€è‡´æ€§**å¦‚ä½•ä¿è¯ï¼Ÿ
- å¦‚ä½•é¿å…ç¼“å­˜**ç©¿é€**çš„é—®é¢˜ï¼Ÿ
- å¦‚ä½•é¿å…ç¼“å­˜**å‡»ç©¿**çš„é—®é¢˜ï¼Ÿ 
- å¦‚æœé¿å…ç¼“å­˜**é›ªå´©**çš„é—®é¢˜ï¼Ÿ

### å¦‚æœé¿å…ç¼“å­˜â€ç©¿é€â€çš„é—®é¢˜ï¼Ÿ

#### ç¼“å­˜ç©¿é€

ç¼“å­˜ç©¿é€ï¼Œæ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™( *è¢«åŠ¨å†™ï¼ŒæŒ‡çš„æ˜¯ä» DB æŸ¥è¯¢åˆ°æ•°æ®ï¼Œåˆ™æ›´æ–°åˆ°ç¼“å­˜ä¸­* )çš„ï¼Œå¹¶ä¸”å¤„äºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä» DB æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ° DB å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚

#### å¦‚ä½•è§£å†³

æœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ï¼š

- æ–¹æ¡ˆä¸€ï¼Œç¼“å­˜ç©ºå¯¹è±¡ï¼šå½“ä» DB æŸ¥è¯¢æ•°æ®ä¸ºç©ºï¼Œæˆ‘ä»¬ä»ç„¶å°†è¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œå…·ä½“çš„å€¼éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æ ‡è¯†ï¼Œèƒ½å’ŒçœŸæ­£ç¼“å­˜çš„æ•°æ®åŒºåˆ†å¼€ã€‚å¦å¤–ï¼Œéœ€è¦è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œä¸€èˆ¬å»ºè®®ä¸è¦è¶…è¿‡ 5 åˆ†é’Ÿã€‚
- æ–¹æ¡ˆäºŒï¼ŒBloomFilter å¸ƒéš†è¿‡æ»¤å™¨ï¼šåœ¨ç¼“å­˜æœåŠ¡çš„åŸºç¡€ä¸Šï¼Œæ„å»º BloomFilter æ•°æ®ç»“æ„ï¼Œåœ¨ BloomFilter ä¸­å­˜å‚¨å¯¹åº”çš„ KEY æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜è¯¥ KEY å¯¹åº”çš„å€¼ä¸ºç©ºã€‚é‚£ä¹ˆæ•´ä¸ªé€»è¾‘çš„å¦‚ä¸‹ï¼š
  - 1ã€æ ¹æ® KEY æŸ¥è¯¢ç¼“å­˜ã€‚å¦‚æœå­˜åœ¨å¯¹åº”çš„å€¼ï¼Œç›´æ¥è¿”å›ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚
  - 2ã€æ ¹æ® KEY æŸ¥è¯¢åœ¨ç¼“å­˜ BloomFilter çš„å€¼ã€‚å¦‚æœå­˜åœ¨å€¼ï¼Œè¯´æ˜è¯¥ KEY ä¸å­˜åœ¨å¯¹åº”çš„å€¼ï¼Œç›´æ¥è¿”å›ç©ºï¼›å¦‚æœä¸å­˜åœ¨å€¼ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚
  - 3ã€æŸ¥è¯¢ DB å¯¹åº”çš„å€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–°åˆ°ç¼“å­˜ï¼Œå¹¶è¿”å›è¯¥å€¼ã€‚å¦‚æœä¸å­˜åœ¨å€¼ï¼Œæ›´æ–°åˆ° ç¼“å­˜ BloomFilter ä¸­ï¼Œå¹¶è¿”å›ç©ºã€‚

ğŸ¦… **é€‰æ‹©**

è¿™ä¸¤ä¸ªæ–¹æ¡ˆï¼Œå„æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚

|      | ç¼“å­˜ç©ºå¯¹è±¡                            | BloomFilter å¸ƒéš†è¿‡æ»¤å™¨        |
| ---- | -------------------------------- | ------------------------ |
| é€‚ç”¨åœºæ™¯ | 1ã€æ•°æ®å‘½ä¸­ä¸é«˜   2ã€ä¿è¯ä¸€è‡´æ€§               | 1ã€æ•°æ®å‘½ä¸­ä¸é«˜   2ã€æ•°æ®ç›¸å¯¹å›ºå®šã€å®æ—¶æ€§ä½ |
| ç»´æŠ¤æˆæœ¬ | 1ã€ä»£ç ç»´æŠ¤ç®€å•   2ã€éœ€è¦è¿‡å¤šçš„ç¼“å­˜ç©ºé—´   3ã€æ•°æ®ä¸ä¸€è‡´ | 1ã€ä»£ç ç»´æŠ¤å¤æ‚   2ã€ç¼“å­˜ç©ºé—´å ç”¨å°     |

- å¯¹äº BloomFilter å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½¿ç”¨åœºæ™¯ä¸­çš„â€œæ•°æ®ç›¸å¯¹å›ºå®šã€å®æ—¶æ€§ä½â€ ï¼ŒTODO ä¸æ”¯æŒåˆ é™¤ï¼Ÿ

å®é™…æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ–¹æ¡ˆäºŒæ¯”è¾ƒå¤šã€‚å› ä¸ºï¼Œç›¸æ¯”æ–¹æ¡ˆä¸€æ¥è¯´ï¼Œæ›´åŠ èŠ‚çœå†…å®¹ï¼Œå¯¹ç¼“å­˜çš„è´Ÿè·æ›´å°ã€‚å¹¶ä¸”ï¼Œå¸¸ç”¨çš„ç¼“å­˜ Redis æ”¯æŒæ„å»º BloomFilter æ•°æ®ç»“æ„ï¼Œå…·ä½“å¯ä»¥çœ‹çœ‹å¦‚ä¸‹æ–‡ç« ï¼š

## JVM

###JVM åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ

1. æ ‡è®°-æ¸…é™¤ç®—æ³•
2. æ ‡è®°-æ•´ç†ç®—æ³•
3. å¤åˆ¶ç®—æ³•
4. åˆ†ä»£æ”¶é›†ç®—æ³•

###JVMåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä½•æ—¶è§¦å‘MinorGCç­‰æ“ä½œ

å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£ Eden åŒºä¸­åˆ†é…ï¼Œå¦‚æœ Eden åŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡ Young GC ã€‚



###ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç° Full GCï¼Ÿ

- 1ã€åœ¨æ‰§è¡Œ Young GC ä¹‹å‰ï¼ŒJVM ä¼šè¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿â€”â€”å¦‚æœè€å¹´ä»£çš„è¿ç»­ç©ºé—´å°äºæ–°ç”Ÿä»£å¯¹è±¡çš„æ€»å¤§å°ï¼ˆæˆ–å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°ï¼‰ï¼Œåˆ™è§¦å‘ä¸€æ¬¡ Full GC ã€‚
- 2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä»å¹´è½»ä»£æ™‹å‡ä¸Šæ¥çš„è€å¯¹è±¡ï¼Œå°è¯•åœ¨è€å¹´ä»£åˆ†é…å†…å­˜æ—¶ï¼Œä½†æ˜¯è€å¹´ä»£å†…å­˜ç©ºé—´ä¸å¤Ÿã€‚
- 3ã€æ˜¾å¼è°ƒç”¨ `System#gc()` æ–¹æ³•æ—¶ã€‚//å»ºè®®jvmæ‰§è¡Œfullgcï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œ 
- 4ã€æ‰§è¡Œäº†jmap -histo:live pidå‘½ä»¤  //è¿™ä¸ªä¼šç«‹å³è§¦å‘fullgc 



####ç›´æ¥å†…å­˜ï¼ˆå †å¤–å†…å­˜ï¼‰ä¸å †å†…å­˜æ¯”è¾ƒï¼Ÿ

1. ç›´æ¥å†…å­˜ç”³è¯·ç©ºé—´è€—è´¹æ›´é«˜çš„æ€§èƒ½ï¼Œå½“é¢‘ç¹ç”³è¯·åˆ°ä¸€å®šé‡æ—¶å°¤ä¸ºæ˜æ˜¾ã€‚
2. ç›´æ¥å†…å­˜ IO è¯»å†™çš„æ€§èƒ½è¦ä¼˜äºæ™®é€šçš„å †å†…å­˜ï¼Œåœ¨å¤šæ¬¡è¯»å†™æ“ä½œçš„æƒ…å†µä¸‹å·®å¼‚æ˜æ˜¾ã€‚



###å†…å­˜æ³„æ¼çš„å¯èƒ½åŸå› 

1. é™æ€é›†åˆç±»å¼•èµ·å†…å­˜æ³„æ¼ï¼Œå¦‚HashMapï¼ŒArrayListç­‰
2. å„ç§è¿æ¥ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ï¼ˆdataSourse.getConnection()ï¼‰ï¼Œç½‘ç»œè¿æ¥(socket)å’Œioè¿æ¥ï¼Œé™¤éå…¶æ˜¾å¼çš„è°ƒç”¨äº†å…¶closeï¼ˆï¼‰æ–¹æ³•å°†å…¶è¿æ¥å…³é—­ï¼Œå¦åˆ™æ˜¯ä¸ä¼šè‡ªåŠ¨è¢«GC å›æ”¶çš„ã€‚
3. å•ä¾‹æ¨¡å¼ï¼Œä¸æ­£ç¡®ä½¿ç”¨å•ä¾‹æ¨¡å¼æ˜¯å¼•èµ·å†…å­˜æ³„æ¼çš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼Œå•ä¾‹å¯¹è±¡åœ¨åˆå§‹åŒ–åå°†åœ¨JVMçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å­˜åœ¨ï¼ˆä»¥é™æ€å˜é‡çš„æ–¹å¼ï¼‰ï¼Œå¦‚æœå•ä¾‹å¯¹è±¡æŒæœ‰å¤–éƒ¨çš„å¼•ç”¨ã€‚



#### å½“å‡ºç°äº†å†…å­˜æº¢å‡ºï¼Œä½ æ€ä¹ˆæ’é”™

### ä»€ä¹ˆæ˜¯å®‰å…¨ç‚¹ï¼Ÿ

SafePoint å®‰å…¨ç‚¹ï¼Œé¡¾åæ€ä¹‰æ˜¯æŒ‡ä¸€äº›ç‰¹å®šçš„ä½ç½®ï¼Œå½“çº¿ç¨‹è¿è¡Œåˆ°è¿™äº›ä½ç½®æ—¶ï¼Œçº¿ç¨‹çš„ä¸€äº›çŠ¶æ€å¯ä»¥è¢«ç¡®å®š(the threadâ€™s representation of itâ€™s Java machine state is well described)ï¼Œæ¯”å¦‚è®°å½•OopMap çš„çŠ¶æ€ï¼Œä»è€Œç¡®å®š GC Root çš„ä¿¡æ¯ï¼Œä½¿ JVM å¯ä»¥å®‰å…¨çš„è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚å¼€å§‹ GC ã€‚

SafePoint æŒ‡çš„ç‰¹å®šä½ç½®ä¸»è¦æœ‰ï¼š

1. å¾ªç¯çš„æœ«å°¾ (é˜²æ­¢å¤§å¾ªç¯çš„æ—¶å€™ä¸€ç›´ä¸è¿›å…¥ Safepoint ï¼Œè€Œå…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…å®ƒè¿›å…¥ Safepoint )ã€‚
2. æ–¹æ³•è¿”å›å‰ã€‚
3. è°ƒç”¨æ–¹æ³•çš„ Call ä¹‹åã€‚
4. æŠ›å‡ºå¼‚å¸¸çš„ä½ç½®ã€‚

è¯¦ç»†çš„å†…å®¹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šæ·±å…¥å­¦ä¹  JVM-JVM å®‰å…¨ç‚¹å’Œå®‰å…¨åŒºåŸŸã€‹](https://my.oschina.net/wenbo123/blog/1822414) ã€‚

#### å®‰å…¨åŒºåŸŸ

> å¦‚æœç¨‹åºé•¿æ—¶é—´ä¸æ‰§è¡Œï¼Œæ¯”å¦‚çº¿ç¨‹è°ƒç”¨çš„ sleep æ–¹æ³•ï¼Œè¿™æ—¶å€™ç¨‹åºæ— æ³•å“åº” JVM ä¸­æ–­è¯·æ±‚è¿™æ—¶å€™çº¿ç¨‹æ— æ³•åˆ°è¾¾å®‰å…¨ç‚¹ï¼Œæ˜¾ç„¶ JVM ä¹Ÿä¸å¯èƒ½ç­‰å¾…ç¨‹åºå”¤é†’ï¼Œè¿™æ—¶å€™å°±éœ€è¦å®‰å…¨åŒºåŸŸäº†ã€‚
>
> å®‰å…¨åŒºåŸŸæ˜¯æŒ‡ä¸€æ®µä»£ç ç‰‡ä¸­ï¼Œå¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä»»ä½•åœ°æ–¹ GC éƒ½æ˜¯å®‰å…¨çš„ï¼Œå®‰å…¨åŒºåŸŸå¯ä»¥çœ‹åšæ˜¯å®‰å…¨ç‚¹çš„ä¸€ä¸ªæ‰©å±•ã€‚
>
> - çº¿ç¨‹æ‰§è¡Œåˆ°å®‰å…¨åŒºåŸŸçš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†è‡ªå·±è¿›å…¥äº†å®‰å…¨åŒºåŸŸï¼Œè¿™æ · GC æ—¶å°±ä¸ç”¨ç®¡è¿›å…¥å®‰å…¨åŒºåŸŸçš„çº¿ç¨‹äº†.
> - çº¿ç¨‹è¦ç¦»å¼€å®‰å…¨åŒºåŸŸæ—¶å°±æ£€æŸ¥ JVM æ˜¯å¦å®Œæˆäº† GC Roots æšä¸¾ï¼ˆæˆ–è€…æ•´ä¸ª GC è¿‡ç¨‹ï¼‰ï¼Œå¦‚æœå®Œæˆå°±ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰å®Œæˆå°±ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€çš„ä¿¡å·ã€‚

### å¯¹è±¡åˆ†é…è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

- å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨ Eden åŒºã€‚

  > å¦‚æœ Eden åŒºæ— æ³•åˆ†é…ï¼Œé‚£ä¹ˆå°è¯•æŠŠæ´»ç€çš„å¯¹è±¡æ”¾åˆ° Survivor0 ä¸­å»ï¼ˆMinor GCï¼‰
  >
  > - å¦‚æœ Survivor0 å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆæ”¾å…¥ä¹‹åæ¸…é™¤ Eden åŒºã€‚
  > - å¦‚æœ Survivor0 ä¸å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆå°è¯•æŠŠ Eden å’Œ Survivor0 çš„å­˜æ´»å¯¹è±¡æ”¾åˆ° Survivor1 ä¸­ã€‚
  >   - å¦‚æœ Survivor1 å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆæ”¾å…¥ Survivor1 ä¹‹åæ¸…é™¤ Eden å’Œ Survivor0 ï¼Œä¹‹åå†æŠŠ Survivor1 ä¸­çš„å¯¹è±¡å¤åˆ¶åˆ° Survivor0 ä¸­ï¼Œä¿æŒ Survivor1 ä¸€ç›´ä¸ºç©ºã€‚
  >   - å¦‚æœ Survivor1 ä¸å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆç›´æ¥æŠŠå®ƒä»¬æ”¾å…¥åˆ°è€å¹´ä»£ä¸­ï¼Œå¹¶æ¸…é™¤ Eden å’Œ Survivor0 ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸º**åˆ†é…æ‹…ä¿**ã€‚
  >
  > psï¼šæ¸…é™¤ Edenã€Survivor åŒºï¼Œå°±æ˜¯ Minor GC ã€‚
  >
  > æ€»ç»“æ¥è¯´ï¼Œåˆ†é…çš„é¡ºåºæ˜¯ï¼šæ–°ç”Ÿä»£ï¼ˆEden => Survivor0 => Survivor1ï¼‰=> è€å¹´ä»£

- å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼ˆå¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼‰ã€‚

  > è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œé¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´ï¼ˆæ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•æ”¶é›†å†…å­˜ï¼‰ã€‚

- é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚

  > è™šæ‹Ÿæœºä¸ºæ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œå¦‚æœå¯¹è±¡ç»è¿‡äº† 1 æ¬¡ Minor GC é‚£ä¹ˆå¯¹è±¡ä¼šè¿›å…¥ Survivor åŒºï¼Œä¹‹åæ¯ç»è¿‡ä¸€æ¬¡ Minor GC é‚£ä¹ˆå¯¹è±¡çš„å¹´é¾„åŠ  1 ï¼ŒçŸ¥é“è¾¾åˆ°é˜€å€¼å¯¹è±¡è¿›å…¥è€å¹´åŒºã€‚

- åŠ¨æ€åˆ¤æ–­å¯¹è±¡çš„å¹´é¾„ã€‚

  > ä¸ºäº†æ›´å¥½çš„é€‚ç”¨ä¸åŒç¨‹åºçš„å†…å­˜æƒ…å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ã€‚
  >
  > å¦‚æœ Survivor åŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚

- ç©ºé—´åˆ†é…æ‹…ä¿ã€‚

  > æ¯æ¬¡è¿›è¡Œ Minor GC æ—¶ï¼ŒJVM ä¼šè®¡ç®— Survivor åŒºç§»è‡³è€å¹´åŒºçš„å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœè¿™ä¸ªå€¼å¤§äºè€å¹´åŒºçš„å‰©ä½™å€¼å¤§å°åˆ™è¿›è¡Œä¸€æ¬¡ Full GC ï¼Œå¦‚æœå°äºæ£€æŸ¥ HandlePromotionFailure è®¾ç½®ï¼Œå¦‚æœ `true` åˆ™åªè¿›è¡Œ Monitor GC ï¼Œå¦‚æœ `false` åˆ™è¿›è¡Œ Full GC ã€‚



### ç±»åŠ è½½

#### Class.forNameå’ŒClassLoaderåŠ è½½ç±»çš„åŒºåˆ«

1. Class.forNameå¯ä»¥æŒ‡å®šæ˜¯å¦åˆå§‹åŒ–`public static Class<?> forName(String name, boolean initialize,ClassLoader loader)`,å¦‚æœå‚æ•°`initialize`ä¸ºtrueï¼Œåˆ™åŠ è½½çš„ç±»å°†ä¼šè¢«åˆå§‹åŒ–ä¹Ÿå°±æ˜¯åˆå§‹åŒ–ä¸€äº›é™æ€å—å’Œé™æ€æ–¹æ³•çš„æ‰§è¡Œ

2. ä½¿ç”¨åœºæ™¯ï¼šåœ¨æˆ‘ä»¬ç†Ÿæ‚‰çš„Springæ¡†æ¶ä¸­çš„IOCçš„å®ç°å°±æ˜¯ä½¿ç”¨çš„ClassLoaderã€‚

   è€Œåœ¨æˆ‘ä»¬ä½¿ç”¨JDBCæ—¶é€šå¸¸æ˜¯ä½¿ç”¨Class.forName()æ–¹æ³•æ¥åŠ è½½æ•°æ®åº“è¿æ¥é©±åŠ¨ã€‚

   è¿™æ˜¯å› ä¸ºåœ¨JDBCè§„èŒƒä¸­æ˜ç¡®è¦æ±‚Driver(æ•°æ®åº“é©±åŠ¨)ç±»å¿…é¡»å‘DriverManageræ³¨å†Œè‡ªå·±ã€‚`com.mysql.jdbc.Driver`ç±»æœ‰æœ‰ä¸€å—é™æ€ä»£ç `DriverManager.registerDriver(new Driver());`





##Linux

## åˆ†å¸ƒå¼

### ç†è®º



#### ä¸€è‡´æ€§hashç®—æ³•åŸç†ä¸åº”ç”¨

####  CAPåŸåˆ™

#### åˆ†å¸ƒå¼raftç®—æ³•

**æ¦‚å¿µ**

Raftæ˜¯å®ç°åˆ†å¸ƒå¼å…±è¯†çš„ä¸€ç§ç®—æ³•ï¼Œä¸»è¦ç”¨æ¥ç®¡ç†æ—¥å¿—å¤åˆ¶çš„ä¸€è‡´æ€§ã€‚å®ƒå’ŒPaxosçš„åŠŸèƒ½æ˜¯ä¸€æ ·ï¼Œä½†æ˜¯ç›¸æ¯”äºPaxosï¼ŒRaftç®—æ³•æ›´å®¹æ˜“ç†è§£ã€ä¹Ÿæ›´å®¹æ˜“åº”ç”¨åˆ°å®é™…çš„ç³»ç»Ÿå½“ä¸­ã€‚è€ŒRaftç®—æ³•ä¹Ÿæ˜¯è”ç›Ÿé“¾é‡‡ç”¨æ¯”è¾ƒå¤šçš„å…±è¯†ç®—æ³•ã€‚

**Raftçš„ä¸‰ç§çŠ¶æ€ï¼ˆè§’è‰²ï¼‰**

Followerï¼ˆç¾¤ä¼—ï¼‰

è¢«åŠ¨æ¥æ”¶Leaderå‘é€çš„è¯·æ±‚ã€‚æ‰€æœ‰çš„èŠ‚ç‚¹åˆšå¼€å§‹çš„æ—¶å€™æ˜¯å¤„äºFollowerçŠ¶æ€ã€‚

Candidateï¼ˆå€™é€‰äººï¼‰

ç”±Followerå‘Leaderè½¬æ¢çš„ä¸­é—´çŠ¶æ€

Leaderï¼ˆé¢†å¯¼ï¼‰

è´Ÿè´£å’Œå®¢æˆ·ç«¯äº¤äº’ä»¥åŠæ—¥å¿—å¤åˆ¶ï¼ˆæ—¥å¿—å¤åˆ¶æ˜¯å•å‘çš„ï¼Œå³Leaderå‘é€ç»™Followerï¼‰ï¼ŒåŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰1ä¸ªLeaderå­˜åœ¨ã€‚

##### ä»»æœŸï¼ˆTermï¼‰æ¦‚å¿µ



#### è¯»å†™åˆ†ç¦»ç¼ºç‚¹

- **æ•°æ®ä¸€è‡´æ€§é—®é¢˜**ã€‚æ•°æ®ä»ä¸»èŠ‚ç‚¹è½¬åˆ°ä»èŠ‚ç‚¹å¿…ç„¶ä¼šæœ‰ä¸€ä¸ªå»¶æ—¶çš„æ—¶é—´çª—å£ï¼Œè¿™ä¸ªæ—¶é—´ çª—å£ä¼šå¯¼è‡´ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ã€‚æŸä¸€æ—¶åˆ»ï¼Œåœ¨ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ä¸­ A æ•°æ®çš„å€¼éƒ½ä¸º Xï¼Œ ä¹‹åå°†ä¸»èŠ‚ç‚¹ä¸­ A çš„å€¼ä¿®æ”¹ä¸º Yï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªå˜æ›´é€šçŸ¥åˆ°ä»èŠ‚ç‚¹ä¹‹å‰ï¼Œåº”ç”¨è¯»å–ä»èŠ‚ç‚¹ä¸­çš„ A æ•°æ®çš„å€¼å¹¶ä¸ä¸ºæœ€æ–°çš„ Yï¼Œç”±æ­¤ä¾¿äº§ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚
- **å»¶æ—¶é—®é¢˜**ã€‚ç±»ä¼¼ Redis è¿™ç§ç»„ä»¶ï¼Œæ•°æ®ä»å†™å…¥ä¸»èŠ‚ç‚¹åˆ°åŒæ­¥è‡³ä»èŠ‚ç‚¹ä¸­çš„è¿‡ç¨‹éœ€è¦ç» å†ç½‘ç»œâ†’ä¸»èŠ‚ç‚¹å†…å­˜â†’ç½‘ç»œâ†’ä»èŠ‚ç‚¹å†…å­˜è¿™å‡ ä¸ªé˜¶æ®µï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šè€—è´¹ä¸€å®šçš„æ—¶é—´ã€‚è€Œåœ¨ Kafka ä¸­ï¼Œä¸»ä»åŒæ­¥ä¼šæ¯” Redis æ›´åŠ è€—æ—¶ï¼Œå®ƒéœ€è¦ç»å†ç½‘ç»œâ†’ä¸»èŠ‚ç‚¹å†…å­˜â†’ä¸»èŠ‚ç‚¹ç£ç›˜â†’ç½‘ç»œâ†’ä»èŠ‚ ç‚¹å†…å­˜â†’ä»èŠ‚ç‚¹ç£ç›˜è¿™å‡ ä¸ªé˜¶æ®µã€‚å¯¹å»¶æ—¶æ•æ„Ÿçš„åº”ç”¨è€Œè¨€ï¼Œä¸»å†™ä»è¯»çš„åŠŸèƒ½å¹¶ä¸å¤ªé€‚ç”¨ã€‚



### åšæœåŠ¡å‘ç°å¸¸ç”¨çš„æ¡†æ¶

- zookeeper
- eureka
- etcd
- consul












